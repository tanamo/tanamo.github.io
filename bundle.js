(()=>{"use strict";class t{constructor(t=0,e=0){this.x=t,this.y=e}add(t){return this.x+=t.x,this.y+=y.x,this}addPoints(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}sub(t){return this.x-=t.x,this.y-=y.x,this}subPoints(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}mult(t){return this.x*=t,this.y*=t,this}div(t){return this.x/=t,this.y/=t,this}}class e{constructor(){this.data=[1,0,0,0,1,0,0,0,1]}identity(){const t=this.data;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}translate(t,i){let s=new e;s.data[6]=t,s.data[7]=i,this.multiply(s)}scale(t,i){if(1!=t||1!=i){let s=new e;s.data[0]=t,s.data[4]=i,this.multiply(s)}}rotate(t){if(0!=t){let i=new e;const s=Math.cos(t*Math.PI/180),h=Math.sin(t*Math.PI/180);i.data[0]=s,i.data[1]=h,i.data[3]=-h,i.data[4]=s,this.multiply(i)}}transform(t,e){const i=this.data;return{x:t*i[0]+e*i[3]+i[6],y:t*i[1]+e*i[4]+i[7]}}multiply(t){return this.multiplyMatrices(this,t)}multiplyMatrices(t,e){const i=t.data,s=e.data,h=this.data,n=i[0],o=i[1],l=i[2],r=i[3],m=i[4],a=i[5],_=i[6],d=i[7],c=i[8],u=s[0],g=s[1],x=s[2],E=s[3],p=s[4],P=s[5],b=s[6],y=s[7],f=s[8];return h[0]=n*u+o*E+l*b,h[1]=n*g+o*p+l*y,h[2]=n*x+o*P+l*f,h[3]=r*u+m*E+a*b,h[4]=r*g+m*p+a*y,h[5]=r*x+m*P+a*f,h[6]=_*u+d*E+c*b,h[7]=_*g+d*p+c*y,h[8]=_*x+d*P+c*f,this}inverse(){let t=new e;const i=this.data,s=t.data,h=1/(i[0]*(i[4]*i[8]-i[7]*i[5])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]));return s[0]=(i[4]*i[8]-i[7]*i[5])*h,s[1]=(i[2]*i[7]-i[1]*i[8])*h,s[2]=(i[1]*i[5]-i[2]*i[4])*h,s[3]=(i[5]*i[6]-i[3]*i[8])*h,s[4]=(i[0]*i[8]-i[2]*i[6])*h,s[5]=(i[3]*i[2]-i[0]*i[5])*h,s[6]=(i[3]*i[7]-i[6]*i[4])*h,s[7]=(i[6]*i[1]-i[0]*i[7])*h,s[8]=(i[0]*i[4]-i[3]*i[1])*h,t}}class i{constructor(e=new t,i=new t){this.min=e,this.max=i,this.m_center=new t,this.m_halfSize=new t}containsPoint(t){return t.x<=this.max.x&&t.x>=this.min.x&&t.y<=this.max.y&&t.y>=this.min.y}intersects(t){const e=this.center,i=this.halfSize,s=t.center,h=t.halfSize;return!(Math.abs(e.x-s.x)>i.x+h.x||Math.abs(e.y-s.y)>i.y+h.y)}containsRect(t){return this.containsPoint(t.min)&&this.containsPoint(t.max)}get halfSize(){return this.m_halfSize.subPoints(this.max,this.min),this.m_halfSize.div(2)}get center(){return this.m_center.addPoints(this.max,this.min),this.m_center.div(2)}consoleLog(t=""){console.log(t+" min:"+this.min.x+" "+this.min.y+" max:"+this.max.x+" "+this.max.y)}set x(t){const e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}set y(t){const e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}set width(t){this.max.x=this.min.x+t}set height(t){this.max.y=this.min.y+t}get x(){return this.min.x}get y(){return this.min.y}get height(){return this.max.y-this.min.y}get width(){return this.max.x-this.min.x}}class s{constructor(t,e=0){this.m_ne=null,this.m_nw=null,this.m_se=null,this.m_sw=null,this.m_layer=e,this.m_divided=!1,this.boundary=t,this.objects=[]}count(){let t=this.objects.length;return this.m_divided&&(t+=this.m_ne.count(),t+=this.m_nw.count(),t+=this.m_se.count(),t+=this.m_sw.count()),t}query(t,e=!1){if(!this.boundary.intersects(t))return[];let i=[];for(let s of this.objects){let h=t.intersects(s.boundary);(!e&&h||e&&!h)&&i.push(s)}return this.m_divided&&(i=i.concat(this.m_ne.query(t,e)),i=i.concat(this.m_nw.query(t,e)),i=i.concat(this.m_se.query(t,e)),i=i.concat(this.m_sw.query(t,e))),i}clear(){this.m_divided=!1,this.objects=[],null!=this.m_ne&&this.m_ne.clear(),null!=this.m_nw&&this.m_nw.clear(),null!=this.m_sw&&this.m_sw.clear(),null!=this.m_se&&this.m_se.clear()}insert(t){return!!this.boundary.intersects(t.boundary)&&(this.objects.length<200&&!this.m_divided||this.m_layer>10?(this.objects.push(t),!0):(this.m_divided||this.subdivide(),!!(this.m_ne.insert(t)||this.m_nw.insert(t)||this.m_se.insert(t)||this.m_sw.insert(t))))}subdivide(){if(this.m_divided=!0,null!=this.m_ne)return;const e=this.boundary.center;this.m_ne=new s(new i(e,this.boundary.max),this.m_layer+1),this.m_nw=new s(new i(new t(this.boundary.min.x,e.y),new t(e.x,this.boundary.max.y)),this.m_layer+1),this.m_sw=new s(new i(this.boundary.min,e),this.m_layer+1),this.m_se=new s(new i(new t(e.x,this.boundary.min.y),new t(this.boundary.max.x,e.y)),this.m_layer+1)}draw(){const t=document.getElementById("xwidget").getContext("2d");this.drawQuadTree(this,t)}drawQuadTree(t,e){if(null!=t){e.save(),e.resetTransform(),e.strokeStyle="red",e.lineWidth=t.m_layer+2;let i=t.boundary.max.x-t.boundary.min.x,s=t.boundary.max.y-t.boundary.min.y;e.strokeRect(t.boundary.min.x+1,t.boundary.min.y+1,i-2,s-2);for(let i of t.objects){let t=i.boundary.max.x-i.boundary.min.x,s=i.boundary.max.y-i.boundary.min.y;e.lineWidth=2,e.strokeStyle="blue",e.strokeRect(i.boundary.min.x,i.boundary.min.y,t,s)}this.drawQuadTree(t.m_nw,e),this.drawQuadTree(t.m_ne,e),this.drawQuadTree(t.m_sw,e),this.drawQuadTree(t.m_se,e),e.restore()}}}const h=1,n=2;class o extends i{constructor(e,i,s,h){super(new t(e,i),new t(s,h))}set left(t){this.min.x=t}get left(){return this.min.x}set top(t){this.min.y=t}get top(){return this.min.y}set right(t){this.max.x=t}get right(){return this.max.x}set bottom(t){this.max.y=t}get bottom(){return this.max.y}}class l{static bound(t,e,i){return Math.max(t,Math.min(e,i))}static linear(t){return t}static inOutQuad(t){let e=t-1,i=2*t;return i<1?t*i:1-e*e*2}static easeOutCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}static lerp(t,e,i,s=l.linear){return t+(e-t)*s(i)}static scaleCanvas(t){let e=t.getContext("2d"),i=window.devicePixelRatio||1,s=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,h=i/s;if(i!==s){let i=t.width,s=t.height;t.width=i*h,t.height=s*h,t.style.width=i+"px",t.style.height=s+"px",e.scale(h,h)}return h}}class r{constructor(){this.active={widget:"rgb(250,250,250)",text:"rgb(0,0,0)",frame:"rgb(186,186,186)",frameHover:"rgb(186,186,186)",highlighted:"rgb(0,172,218)",highlightedText:"white",button:"rgb(240,240,240)",buttonHover:"rgb(230,230,230)",buttonDown:"rgb(200,200,200)",buttonOn:"rgb(0,172,218)",buttonOnHover:"rgb(0,182,228)",buttonOnDown:"rgb(0,192,238)"},this.disabled={widget:"rgb(250,250,250)",text:"rgb(200,200,200)",frame:"rgb(186,186,186)",frameHover:"rgb(186,186,186)",highlighted:"rgb(200,200,200)",highlightedText:"white",button:"rgb(250,250,250)",buttonHover:"rgb(230,230,230)",buttonDown:"rgb(200,200,200)"},this.fontSize=15,this.fontName="Consolas"}}class m extends class{constructor(){this.localPos=new t,this.globalPos=new t,this.m_accepted=!1}accept(){this.m_accepted=!0}ignore(){this.m_accepted=!1}get accepted(){return this.m_accepted}}{static LeftButton=0;static MidButton=1;static RightButton=2;constructor(){super(),this.button=0,this.jsEvent=null}}class a extends m{constructor(){super(),this.deltaY=0,this.deltaX=0}}function _(e,s){const h=e.globalPos.x,n=e.globalPos.y;if(s.isWithinGlobalRect(e.globalPos)&&s.visible&&s.enabled){if(0==s.m_children.length){const t=s.toLocal(e.globalPos);return e.localPos=t,s.mouseDownEvent(e),p.CURRENT_MOUSEDOWN_WIDGET=s,void s.setFocus()}const o=new i(new t(h-1,n-1),new t(h+1,n+1)),l=s.m_quadTree.query(o);for(let t=l.length-1;t>=0;t--){let i=l[t];if(i.visible&&i.enabled){const t=i.toLocal(e.globalPos);if(e.localPos=t,_(e,i),e.accepted)return void(null==p.CURRENT_MOUSEDOWN_WIDGET&&(p.CURRENT_MOUSEDOWN_WIDGET=i,i.setFocus()))}}const r=s.toLocal(e.globalPos);e.localPos=r,s.mouseDownEvent(e),p.CURRENT_MOUSEDOWN_WIDGET=s,s.setFocus()}}function d(e,s){const h=e.globalPos.x,n=e.globalPos.y;if(s.isWithinGlobalRect(e.globalPos)&&s.visible&&s.enabled){if(0==s.m_children.length){const t=s.toLocal(e.globalPos);return e.localPos=t,void s.mouseMoveEvent(e)}const o=new i(new t(h-1,n-1),new t(h+1,n+1)),l=s.m_quadTree.query(o);for(let t=l.length-1;t>=0;t--){let i=l[t];if(i.visible&&i.enabled){const t=i.toLocal(e.globalPos);if(e.localPos=t,d(e,i),e.accepted)return}}const r=s.toLocal(e.globalPos);e.localPos=r,s.mouseMoveEvent(e)}}function c(e,s,h,n){if(h.length>0){let t=h[h.length-1];t.isWithinGlobalRect({x:e,y:s})||(h.pop(),t.mouseLeaveEvent())}if(n.isWithinGlobalRect({x:e,y:s})&&n.visible){if(-1==h.indexOf(n)){if(h.length>0){let t=h[h.length-1];t!=n.parent&&t!=n&&(h.pop(),t.mouseLeaveEvent())}h.push(n),n.mouseEnterEvent()}if(0==n.m_children.length)return;const o=new i(new t(e-1,s-1),new t(e+1,s+1)),l=n.m_quadTree.query(o);for(let t=l.length-1;t>=0;t--){let i=l[t];if(i.visible){c(e,s,h,i);break}}}}function u(e,s){const h=e.globalPos.x,n=e.globalPos.y;if(s.isWithinGlobalRect(e.globalPos)&&s.visible&&s.enabled){if(0==s.m_children.length){const t=s.toLocal(e.globalPos);return e.localPos=t,void s.doubleClickEvent(e)}const o=new i(new t(h-1,n-1),new t(h+1,n+1)),l=s.m_quadTree.query(o);for(let t=l.length-1;t>=0;t--){let i=l[t];if(i.visible&&i.enabled){const t=i.toLocal(e.globalPos);if(e.localPos=t,u(e,i),e.accepted)return}}const r=s.toLocal(e.globalPos);e.localPos=r,s.doubleClickEvent(e)}}function g(e,s){const h=e.globalPos.x,n=e.globalPos.y;if(s.isWithinGlobalRect(e.globalPos)&&s.visible&&s.enabled){if(0==s.m_children.length){const t=s.toLocal(e.globalPos);return e.localPos=t,void s.wheelEvent(e)}const o=new i(new t(h-1,n-1),new t(h+1,n+1)),l=s.m_quadTree.query(o);for(let t=l.length-1;t>=0;t--){let i=l[t];if(i.visible&&i.enabled){const t=i.toLocal(e.globalPos);if(e.localPos=t,g(e,i),e.accepted)return}}const r=s.toLocal(e.globalPos);e.localPos=r,s.wheelEvent(e)}}function x(t,e){console.log("init canvas events"),t.addEventListener("mousedown",(function(e){t.focus();const i=t.getBoundingClientRect(),s=e.clientX-i.left,h=e.clientY-i.top;let n=new m;n.globalPos.x=s,n.globalPos.y=h,n.button=e.button;let o=p.ROOT_WIDGET_MAP.get(t);for(let t=o.length-1;t>=0&&(_(n,o[t]),!n.accepted);t--);})),t.addEventListener("touchstart",(function(e){let i=e.touches[0];t.focus();const s=t.getBoundingClientRect(),h=i.clientX-s.left,n=i.clientY-s.top;let o=new m;o.globalPos.x=h,o.globalPos.y=n,o.button=0;let l=p.ROOT_WIDGET_MAP.get(t);for(let t=l.length-1;t>=0&&(_(o,l[t]),!o.accepted);t--);e.preventDefault()}),!1),t.addEventListener("mouseup",(function(e){const i=t.getBoundingClientRect(),s=e.clientX-i.left,h=e.clientY-i.top;if(null!=p.CURRENT_MOUSEDOWN_WIDGET){let t=new m;t.globalPos.x=s,t.globalPos.y=h,t.button=e.button,t.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(t.globalPos),p.CURRENT_MOUSEDOWN_WIDGET.mouseUpEvent(t)}p.CURRENT_MOUSEDOWN_WIDGET=null})),t.addEventListener("touchend",(function(e){let i=e.changedTouches[0];const s=t.getBoundingClientRect(),h=i.clientX-s.left,n=i.clientY-s.top;if(null!=p.CURRENT_MOUSEDOWN_WIDGET){let t=new m;t.globalPos.x=h,t.globalPos.y=n,t.button=0,t.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(t.globalPos),p.CURRENT_MOUSEDOWN_WIDGET.mouseUpEvent(t)}p.CURRENT_MOUSEDOWN_WIDGET=null,e.preventDefault()}),!1),t.addEventListener("dblclick",(function(e){t.focus();const i=t.getBoundingClientRect(),s=e.clientX-i.left,h=e.clientY-i.top;let n=new m;n.globalPos.x=s,n.globalPos.y=h,n.button=e.button;let o=p.ROOT_WIDGET_MAP.get(t);for(let t=o.length-1;t>=0&&(u(n,o[t]),!n.accepted);t--);})),t.addEventListener("mousemove",(function(e){const i=t.getBoundingClientRect(),s=e.clientX-i.left,h=e.clientY-i.top;let n=new m;if(n.globalPos.x=s,n.globalPos.y=h,n.button=e.button,null!=p.CURRENT_MOUSEDOWN_WIDGET)return n.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(n.globalPos),void p.CURRENT_MOUSEDOWN_WIDGET.mouseMoveEvent(n);let o=p.ROOT_WIDGET_MAP.get(t);for(let t=o.length-1;t>=0&&(d(n,o[t]),!n.accepted);t--);})),t.addEventListener("touchmove",(function(e){let i=e.changedTouches[0];const s=t.getBoundingClientRect(),h=i.clientX-s.left,n=i.clientY-s.top;let o=new m;if(o.globalPos.x=h,o.globalPos.y=n,o.button=0,null!=p.CURRENT_MOUSEDOWN_WIDGET)return o.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(o.globalPos),void p.CURRENT_MOUSEDOWN_WIDGET.mouseMoveEvent(o);let l=p.ROOT_WIDGET_MAP.get(t);for(let t=l.length-1;t>=0&&(d(o,l[t]),!o.accepted);t--);e.preventDefault()})),t.addEventListener("wheel",(function(e){const i=t.getBoundingClientRect(),s=e.clientX-i.left,h=e.clientY-i.top;let n=new a;n.globalPos.x=s,n.globalPos.y=h,n.button=e.button,n.deltaY=e.deltaY,n.deltaX=e.deltaX;let o=p.ROOT_WIDGET_MAP.get(t);for(let t=o.length-1;t>=0&&(g(n,o[t]),!n.accepted);t--);}),{passive:!0}),t.addEventListener("mouseenter",(function(t){})),t.addEventListener("mouseleave",(function(t){})),t.addEventListener("blur",(function(){p.CURRENT_FOCUS_WIDGET&&p.CURRENT_FOCUS_WIDGET.clearFocus(),p.CURRENT_FOCUS_WIDGET=null}))}window.addEventListener("keydown",(function(t){null!=p.CURRENT_FOCUS_WIDGET&&(p.CURRENT_FOCUS_WIDGET.keyDownEvent(t),t.preventDefault())}),!1),window.addEventListener("keyup",(function(t){null!=p.CURRENT_FOCUS_WIDGET&&(p.CURRENT_FOCUS_WIDGET.keyUpEvent(t),t.preventDefault())}),!1),window.addEventListener("mousemove",(function(t){if(null!=p.CURRENT_MOUSEDOWN_WIDGET){const e=p.CURRENT_MOUSEDOWN_WIDGET.m_canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;if(i>=0&&i<=e.width&&s>=0&&s<=e.height)return;console.log("window mouse move");let h=new m;h.globalPos.x=i,h.globalPos.y=s,h.button=t.button,h.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(h.globalPos),p.CURRENT_MOUSEDOWN_WIDGET.mouseMoveEvent(h)}else for(let e of p.CANVAS_LIST){const i=e.getBoundingClientRect(),s=t.clientX-i.left,h=t.clientY-i.top;let n=p.ROOT_WIDGET_MAP.get(e),o=p.MOUSE_ENTER_MAP.get(e);for(let t=n.length-1;t>=0;t--)c(s,h,o,n[t])}}),!1),window.addEventListener("mouseup",(function(t){if(null!=p.CURRENT_MOUSEDOWN_WIDGET){const e=p.CURRENT_MOUSEDOWN_WIDGET.m_canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;if(i>=0&&i<=e.width&&s>=0&&s<=e.height)return;console.log("window mouse up");let h=new m;h.globalPos.x=i,h.globalPos.y=s,h.button=t.button,h.localPos=p.CURRENT_MOUSEDOWN_WIDGET.toLocal(h.globalPos),p.CURRENT_MOUSEDOWN_WIDGET.mouseUpEvent(h),p.CURRENT_MOUSEDOWN_WIDGET=null}}),!1);class E{constructor(t){this.m_widget=t,this.m_listenersMap=new Map}addListener(t,e){this.m_listenersMap.has(t)||this.m_listenersMap.set(t,[]),this.m_listenersMap.get(t).push(e)}removeListener(t,e){if(this.m_listenersMap.has(t)){let i=this.m_listenersMap.get(t);const s=i.indexOf(e);-1!=s&&i.splice(s,1)}}invoke(t,e=null){if(this.m_listenersMap.has(t)){let i=this.m_listenersMap.get(t);for(let s of i)s instanceof p?s.customEvent(this.m_widget,t,e):s(this.m_widget,e)}}}class p{static CANVAS_LIST=[];static ROOT_WIDGET_MAP=new Map;static MOUSE_ENTER_MAP=new Map;static CURRENT_MOUSEDOWN_WIDGET=null;static CURRENT_FOCUS_WIDGET=null;static DEVICE_PIXEL_RATIO=1;constructor(s){this.m_x=0,this.m_y=0,this.m_rotation=0,this.m_scale=1,this.m_width=1,this.m_height=1,this.m_minWidth=0,this.m_minHeight=0,this.m_maxWidth=Number.MAX_SAFE_INTEGER,this.m_maxHeight=Number.MAX_SAFE_INTEGER,this.m_children=[],this.m_transformation=new e,this.m_absoluteTransformation=new e,this.m_dirty=!0,this.m_clipped=!1,this.m_quadTree=null,this.m_visible=!0,this.m_focusable=!0,this.m_layout=null,this.m_enabled=!0,this.m_stretch=1,this.m_style=new r,this.m_contentsMargins=new o(0,0,0,0),this.objectName="",this.m_boundary=new i(new t(0,0),new t(10,10)),this.m_sizeChanged=!1,this.m_childrenMouseEntered=[],this.m_childrenMouseDown=[],this.m_eventListener=new E(this),s instanceof p?s.addChild(this):s instanceof HTMLCanvasElement?(this.m_parent=null,this.m_canvas=s,this.m_context=s.getContext("2d"),-1==p.CANVAS_LIST.indexOf(this.m_canvas)&&(x(this.m_canvas),p.DEVICE_PIXEL_RATIO=function(t){let e=t.getContext("2d"),i=window.devicePixelRatio||1,s=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,h=i/s;if(i!==s){let i=t.width,s=t.height;t.width=i*h,t.height=s*h,t.style.width=i+"px",t.style.height=s+"px",e.scale(h,h)}return h}(this.m_canvas),this.m_canvas.tabIndex=p.CANVAS_LIST.length,p.CANVAS_LIST.push(this.m_canvas)),p.ROOT_WIDGET_MAP.has(this.m_canvas)||p.ROOT_WIDGET_MAP.set(this.m_canvas,[]),p.ROOT_WIDGET_MAP.get(this.m_canvas).push(this),p.MOUSE_ENTER_MAP.has(this.m_canvas)||p.MOUSE_ENTER_MAP.set(this.m_canvas,[])):(this.m_parent=null,this.m_canvas=null,this.m_context=null)}addChild(e){e instanceof p&&e.m_parent!=this&&(null!=e.parent&&e.parent.removeChild(e),null==this.m_quadTree&&(this.m_quadTree=new s(new i(new t(0,0),new t(10,10)),0)),this.m_children.push(e),e.m_parent=this,e.canvas=this.m_canvas,this.m_dirty=!0,null!=this.m_layout&&(this.m_layout.dirty=!0),e.parentChangeEvent(),e.invokeEvent("parentChanged"))}removeChild(t){if(t instanceof p&&t.m_parent==this){const e=this.m_children.indexOf(t);this.m_children.splice(e,1),t.m_parent=null,t.canvas=null,this.m_dirty=!0,null!=this.m_layout&&this.m_layout.removeWidget(t),t.parentChangeEvent(),t.invokeEvent("parentChanged")}}get parent(){return this.m_parent}set canvas(t){this.m_canvas=t,null==this.m_parent&&x(this.m_canvas),this.m_context=null!=t?t.getContext("2d"):null;for(let e of this.m_children)e.canvas=t}get canvas(){return this.m_canvas}get context(){return this.m_context}addEventListener(t,e){this.m_eventListener.addListener(t,e)}removeEventListener(t,e){this.m_eventListener.removeListener(t,e)}invokeEvent(t,e=null){this.m_eventListener.invoke(t,e)}set dirty(t){this.m_dirty=t}get dirty(){return this.m_dirty}set focusable(t){this.m_focusable=t}get focusable(){return this.m_focusable}setFocus(){p.CURRENT_FOCUS_WIDGET!=this&&this.m_focusable&&(null!=p.CURRENT_FOCUS_WIDGET&&p.CURRENT_FOCUS_WIDGET.focusLeaveEvent(),p.CURRENT_FOCUS_WIDGET=this,this.focusEnterEvent())}clearFocus(){p.CURRENT_FOCUS_WIDGET==this&&(this.focusLeaveEvent(),p.CURRENT_FOCUS_WIDGET=null)}get hasFocus(){return p.CURRENT_FOCUS_WIDGET==this}set enabled(t){this.m_enabled!=t&&(this.m_enabled=t,t?this.invokeEvent("enabled"):this.invokeEvent("disabled"))}get enabled(){return this.m_enabled}set x(t){this.m_x!=t&&(this.m_x=t,this.m_dirty=!0,this.moveEvent(),this.invokeEvent("moved"))}get x(){return this.m_x}set y(t){this.m_y!=t&&(this.m_y=t,this.m_dirty=!0,this.moveEvent(),this.invokeEvent("moved"))}get y(){return this.m_y}set width(t){if(t=l.bound(this.m_minWidth,t,this.m_maxWidth),this.m_width!=t){this.invokeEvent("beforeWidthChanged",t),this.m_width=t,this.m_dirty=!0,null!=this.m_layout&&(this.m_layout.dirty=!0),this.m_sizeChanged=!0,this.resizeEvent(),this.invokeEvent("widthChanged");for(let t of this.m_children)t.parentResizeEvent()}}get width(){return this.m_width}set height(t){if(t=l.bound(this.m_minHeight,t,this.m_maxHeight),this.m_height!=t){this.invokeEvent("beforeHeightChanged",t),this.m_height=t,this.m_dirty=!0,null!=this.m_layout&&(this.m_layout.dirty=!0),this.m_sizeChanged=!0,this.resizeEvent(),this.invokeEvent("heightChanged");for(let t of this.m_children)t.parentResizeEvent()}}get height(){return this.m_height}set minimumWidth(t){this.m_minWidth!=t&&(this.m_minWidth=t,this.width=Math.max(this.m_minWidth,this.width))}get minimumWidth(){return this.m_minWidth}set maximumWidth(t){this.m_maxWidth!=t&&(this.m_maxWidth=t,this.width=Math.min(this.m_maxWidth,this.width))}get maximumWidth(){return this.m_maxWidth}set minimumHeight(t){this.m_minHeight!=t&&(this.m_minHeight=t,this.height=Math.max(this.m_minHeight,this.height))}get minimumHeight(){return this.m_minHeight}set maximumHeight(t){this.m_maxHeight!=t&&(this.m_maxHeight=t,this.height=Math.min(this.m_maxHeight,this.height))}get maximumWidth(){return this.m_maxWidth}get recommendedWidth(){return null!=this.m_layout?this.m_layout.recommendedWidth:0}get recommendedHeight(){return null!=this.m_layout?this.m_layout.recommendedHeight:0}get contentsMargins(){return this.m_contentsMargins}set contentsMargins(t){this.m_contentsMargins=t,this.m_dirty=!0,null!=this.m_layout&&(this.m_layout.dirty=!0)}set layout(t){this.m_layout=t,this.m_layout.m_parent=this}get layout(){return this.m_layout}set stretch(t){this.m_stretch=t}get stretch(){return this.m_stretch}set visible(t){this.m_visible!=t&&(this.m_visible=t,t?(this.showEvent(),this.invokeEvent("shown")):(this.hideEvent(),this.invokeEvent("hidden")),null!=this.m_parent&&null!=this.m_parent.layout&&(this.m_parent.layout.dirty=!0))}get visible(){return this.m_visible}set style(t){this.m_style=t}get style(){return this.m_style}set scale(t){this.m_scale!=t&&(this.m_scale=t,this.m_dirty=!0)}set rotation(t){this.m_rotation!=t&&(this.m_rotation=t,this.m_dirty=!0)}raise(){if(null!=this.m_parent){const t=this.m_parent.m_children.indexOf(this);t<this.m_parent.m_children.length-1&&(this.m_parent.m_children.splice(t,1),this.m_parent.m_children.push(this))}}isWithinGlobalRect(t){return null!=this.m_quadTree?this.m_quadTree.boundary.containsPoint(t):this.m_boundary.containsPoint(t)}toLocalPoint(t,e){return this.m_absoluteTransformation.inverse().transform(t,e)}toGlobalPoint(t,e){return this.m_absoluteTransformation.transform(t,e)}toLocal(t){return this.m_absoluteTransformation.inverse().transform(t.x,t.y)}toGlobal(t){return this.m_absoluteTransformation.transform(t.x,t.y)}mouseDownEvent(t){}mouseMoveEvent(t){}mouseUpEvent(t){}mouseEnterEvent(){}mouseLeaveEvent(){}doubleClickEvent(t){}wheelEvent(t){}keyDownEvent(t){}keyUpEvent(t){}focusEnterEvent(){}focusLeaveEvent(){}customEvent(t,e,i=null){}parentChangeEvent(){}resizeEvent(){}moveEvent(){}parentResizeEvent(){}showEvent(){}hideEvent(){}getMetrics(t){if(null!=this.m_context){this.m_context.save(),this.m_context.font=this.style.fontSize+"px "+this.style.fontName;let e=this.m_context.measureText(t);return this.m_context.restore(),e}return null}applyTransformToContext(){const t=this.m_absoluteTransformation.data;this.m_context.setTransform(t[0],t[1],t[3],t[4],t[6]*p.DEVICE_PIXEL_RATIO,t[7]*p.DEVICE_PIXEL_RATIO)}get boundary(){return this.m_boundary}requestUpdate(t){this.update(t),null!=this.m_layout&&this.m_layout.update(t),null!=this.m_quadTree&&this.m_quadTree.clear();for(let e of this.m_children)null==e.m_canvas&&(e.canvas=this.m_canvas),e.requestUpdate(t),null!=this.m_quadTree&&this.m_quadTree.insert(e)}update(t){if(!this.m_dirty)return;this.m_dirty=!1,this.m_transformation.identity(),this.m_transformation.scale(this.m_scale,this.m_scale),this.m_transformation.rotate(this.m_rotation),this.m_transformation.translate(this.m_x,this.m_y),null!=this.m_parent?this.m_absoluteTransformation.multiplyMatrices(this.m_transformation,this.m_parent.m_absoluteTransformation):this.m_absoluteTransformation=this.m_transformation;const e=this.m_absoluteTransformation.transform(0,0),i=this.m_absoluteTransformation.transform(this.m_width,this.m_height);this.m_boundary.min.x=e.x,this.m_boundary.min.y=e.y,this.m_boundary.max.x=i.x,this.m_boundary.max.y=i.y,this.m_children.length>0&&(null==this.m_parent||this.m_parent.m_boundary.containsRect(this.m_boundary)?this.m_quadTree.boundary=this.m_boundary:this.m_quadTree.boundary=this.m_parent.m_boundary);for(let t of this.m_children)t.m_dirty=!0;this.m_sizeChanged&&(this.invokeEvent("sizeChanged"),this.m_sizeChanged=!1)}draw(){if(!this.m_visible)return;this.applyTransformToContext(),this.clipStart(),this.m_context.fillStyle=this.enabled?this.m_style.active.widget:this.m_style.disabled.widget;const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.fillRect(0,0,t,e),this.drawChildren(),this.clipEnd()}drawChildren(){if(this.m_children.length>0){let t=this.m_quadTree.query(this.boundary);for(let e of t)e.m_visible&&e.draw()}}clipStart(t=null){if(!this.m_clipped){this.m_clipped=!0,this.m_context.save();let e=new Path2D;const i=(this.m_width+1)*p.DEVICE_PIXEL_RATIO,s=(this.m_height+1)*p.DEVICE_PIXEL_RATIO;null==t?e.rect(0,0,i,s):e.rect(t.x,t.y,t.width,t.height),this.m_context.clip(e)}}clipEnd(){this.m_clipped&&(this.m_clipped=!1,this.m_context.restore())}}class P extends p{constructor(t){super(t),this.m_frameColor=null,this.m_frameWidth=1}set frameColor(t){this.m_frameColor=t}get frameColor(){return this.m_frameColor}set frameWidth(t){this.m_frameWidth=t}get frameWidth(){return this.m_frameWidth}drawBackground(t){null==t&&(t=this.enabled?this.style.active.widget:this.style.disabled.base);const e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=t,this.m_context.fillRect(0,0,e,i)}drawFrame(t){if(this.frameWidth<=0)return;null==t&&(t=this.enabled?this.style.active.frame:this.style.disabled.frame);const e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_height*p.DEVICE_PIXEL_RATIO,s=.5*p.DEVICE_PIXEL_RATIO,h=this.m_frameWidth*p.DEVICE_PIXEL_RATIO;this.m_context.strokeStyle=t,this.m_context.lineWidth=h,this.m_context.strokeRect(s,s,e,i)}draw(){this.applyTransformToContext(),this.clipStart(),this.drawBackground(this.style.active.widget),this.drawFrame(this.frameColor),this.drawChildren(),this.clipEnd()}}const b=32;class f{constructor(){this.m_lines=[],this.m_fontName="Arial",this.m_fontSize=15,this.m_text=""}set text(t){this.m_text=t,this.m_lines=t.split("\n")}set fontName(t){this.m_fontName=t}set fontSize(t){this.m_fontSize=t}setAlignmentToContext(t,e){2&e?t.textAlign="right":4&e?t.textAlign="center":1&e&&(t.textAlign="left"),t.textBaseline="top"}drawText(t,e,i,s,h,n){t.save(),this.setAlignmentToContext(t,n);let o=0,l=0;2&n?o=e+s:4&n?o=e+s/2:1&n&&(o=e);let r=t.measureText("|");const m=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent,a=m*this.m_lines.length;16&n?l=i+h-a:n&b?l=i+h/2-a/2:8&n&&(l=i);for(let e of this.m_lines)t.fillText(e,o,l),l+=m;t.restore()}}class w extends P{constructor(t="",e=null){super(e),this.m_text=t,this.m_hover=!1,this.m_down=!1,this.objectName="XButton",this.m_textRenderer=new f,this.m_textRenderer.text=t}get recommendedWidth(){const t=this.getMetrics(this.m_text);return null!=t?t.width+20:0}get recommendedHeight(){const t=this.getMetrics("W");return null!=t?3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent):0}get text(){return this.m_text}set text(t){this.m_text=t,this.m_textRenderer.text=t}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;p.DEVICE_PIXEL_RATIO;let i=null;if(i=this.enabled?this.m_down?this.style.active.buttonDown:this.m_hover?this.style.active.buttonHover:this.style.active.button:this.style.disabled.button,this.drawBackground(i),this.drawFrame(null==this.frameColor?this.style.active.frame:this.frameColor),t>1&&e>1){let i=null;i=this.enabled?this.style.active.text:this.style.disabled.text,this.m_context.fillStyle=i;const s=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=s+"px "+this.style.fontName,this.m_textRenderer.drawText(this.m_context,0,0,t,e,36)}this.clipEnd()}mouseDownEvent(t){this.enabled&&(this.m_down=!0),t.accept()}mouseMoveEvent(t){t.accept()}mouseUpEvent(t){this.enabled&&this.boundary.containsPoint(t.globalPos)&&this.invokeEvent("clicked"),this.m_down=!1}mouseEnterEvent(){this.enabled&&(this.m_hover=!0,this.m_canvas.style.cursor="pointer")}mouseLeaveEvent(){this.enabled&&(this.m_hover=!1,this.m_canvas.style.cursor="default")}}class v extends w{constructor(t="",e=null){super(t,e),this.m_on=!1}set on(t){this.m_on=t}get on(){return this.m_on}mouseUpEvent(t){this.enabled&&this.boundary.containsPoint(t.globalPos)&&(this.m_on=!this.m_on,this.invokeEvent("clicked")),this.m_down=!1}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;p.DEVICE_PIXEL_RATIO,p.DEVICE_PIXEL_RATIO;let i=null;if(i=this.enabled?this.m_down?this.m_on?this.style.active.buttonOnDown:null==this.m_downColor?this.style.active.buttonDown:this.m_downColor:this.m_hover?this.m_on?this.style.active.buttonOnHover:null==this.m_hoverColor?this.style.active.buttonHover:this.m_hoverColor:this.m_on?this.style.active.buttonOn:this.style.active.button:this.style.disabled.button,this.m_context.fillStyle=i,this.m_context.fillRect(0,0,t,e),this.drawFrame(null==this.frameColor?this.style.active.frame:this.frameColor),t>1&&e>1){const i=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=i+"px "+this.style.fontName;let s=null;s=this.enabled?this.style.active.text:this.style.disabled.text,this.m_context.fillStyle=s,this.m_textRenderer.drawText(this.m_context,0,0,t,e,36)}this.clipEnd()}}class I extends v{constructor(t="",e=null){super(t,e)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=.5*p.DEVICE_PIXEL_RATIO,s=p.DEVICE_PIXEL_RATIO,h=e-2*p.DEVICE_PIXEL_RATIO;if(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=s,this.m_context.strokeRect(s+i,s+i,h,h),this.m_on){const t=4.5*p.DEVICE_PIXEL_RATIO,e=6*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.style.active.highlighted,this.m_context.fillRect(t,t,h-e,h-e)}if(t>1&&e>1){this.m_context.fillStyle=this.enabled?this.style.active.text:this.style.disabled.text;const i=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=i+"px "+this.style.fontName;const s=10*p.DEVICE_PIXEL_RATIO;this.m_textRenderer.drawText(this.m_context,e+s,0,t,e,33)}this.clipEnd()}}class C extends v{constructor(t="",e=null){super(t,e)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=(p.DEVICE_PIXEL_RATIO,p.DEVICE_PIXEL_RATIO),s=e-2*p.DEVICE_PIXEL_RATIO;if(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=i,this.m_context.beginPath(),this.m_context.arc(s/2+i,s/2+i,s/2,0,2*Math.PI),this.m_context.stroke(),this.m_on){const t=4*p.DEVICE_PIXEL_RATIO,i=e-2*t;this.m_context.fillStyle=this.style.active.highlighted,this.m_context.beginPath(),this.m_context.arc(i/2+t,i/2+t,i/2,0,2*Math.PI),this.m_context.fill()}if(t>1&&e>1){this.m_context.fillStyle=this.enabled?this.style.active.text:this.style.disabled.text;const i=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=i+"px "+this.style.fontName;const s=10*p.DEVICE_PIXEL_RATIO;this.m_textRenderer.drawText(this.m_context,e+s,0,t,e,33)}this.clipEnd()}}class T extends w{constructor(t,e){super(t,e),this.m_index=-1,this.m_currentIndex=-1,this.m_current=!1,this.m_first=!1,this.m_last=!1,this.m_move=!1,this.m_origGlobalX=0,this.m_origGlobalPosX=0,this.m_movingTimer=0,this.m_moving=!1,this.m_endPosX=-1,this.m_startPosX=-1}mouseDownEvent(t){this.m_move=!0,this.m_origGlobalX=t.globalPos.x;let e=this.toGlobalPoint(0,0);this.m_origGlobalPosX=e.x,this.invokeEvent("clicked"),this.raise(),t.accept()}mouseMoveEvent(t){if(this.m_move){this.invokeEvent("moving");const e=this.toGlobalPoint(0,0),i=this.parent.toLocalPoint(this.m_origGlobalPosX+t.globalPos.x-this.m_origGlobalX,e.y);if(this.x=i.x,!this.m_moving){const t=this.m_index*this.width;this.x>t+this.width/2?this.m_parent.moveTabToRight(this.m_index):this.x<t-this.width/2&&this.m_parent.moveTabToLeft(this.m_index)}t.accept()}}mouseUpEvent(t){this.invokeEvent("stopped"),this.m_move=!1}update(t){if(this.m_moving)this.m_movingTimer+=t,this.x=l.lerp(this.m_startPosX,this.m_endPosX,this.m_movingTimer/200,l.inOutQuad),this.m_movingTimer>200&&(this.x=this.m_endPosX,this.m_moving=!1,this.m_movingTimer=0);else if(!this.m_move){const t=this.width,e=this.x,i=this.m_index*t;i!=e&&(this.m_startPosX=e,this.m_endPosX=i,this.m_moving=!0)}super.update(t)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=this.x*p.DEVICE_PIXEL_RATIO,s=(this.parent.currentTabIndex,this.parent.m_buttons.length-1),h=this.m_index+1;let n=null;if(n=this.enabled?this.m_down?this.style.active.buttonDown:this.m_hover?this.style.active.buttonHover:this.style.active.button:this.style.disabled.button,this.drawBackground(n),this.m_context.strokeStyle=this.style.active.frame,this.m_index!=s&&this.parent.m_buttons[h].x*p.DEVICE_PIXEL_RATIO==i+t){const i=5*p.DEVICE_PIXEL_RATIO,s=.5*p.DEVICE_PIXEL_RATIO;this.m_context.beginPath(),this.m_context.moveTo(t-s,i),this.m_context.lineTo(t-s,e-i),this.m_context.closePath(),this.m_context.stroke()}this.m_context.fillStyle=this.style.active.text;const o=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=o+"px "+this.style.fontName,this.m_textRenderer.drawText(this.m_context,0,0,t,e,36),this.clipEnd()}}class S extends p{constructor(t="",e=null){super(e),this.m_text=t,this.m_alignment=33,this.m_textRenderer=new f,this.m_textRenderer.text=t}get text(){return this.m_text}set text(t){this.m_text=t,this.m_textRenderer.text=t}get alignment(){return this.m_alignment}set alignment(t){this.m_alignment=t}get recommendedWidth(){return this.getMetrics(this.m_text).width}get recommendedHeight(){const t=this.getMetrics("W");return 3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.enabled?this.style.active.text:this.style.disabled.text;const i=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=i+"px "+this.style.fontName,this.m_textRenderer.drawText(this.m_context,0,0,t,e,this.alignment),this.clipEnd()}}class R{constructor(){this.stretch=1,this.m_width=0,this.m_height=0,this.m_x=0,this.m_y=0,this.m_visible=!0,this.m_dirty=!0,this.objectName="XLayoutItem"}set x(t){this.m_x=t,this.m_dirty=!0}get x(){return this.m_x}set y(t){this.m_y=t,this.m_dirty=!0}get y(){return this.m_y}set width(t){this.m_width=t,this.m_dirty=!0}get width(){return this.m_width}set height(t){this.m_height=t,this.m_dirty=!0}get height(){return this.m_height}get visible(){return this.m_visible}get recommendedWidth(){return 0}get recommendedHeight(){return 0}}class W extends R{constructor(t=null){super(),t instanceof p?(this.m_parent=t,this.m_parent.layout=this):t instanceof W&&(this.m_parent=t),this.m_spacing=5,this.m_margins=new o(5,5,5,5)}parentWidget(t){let e=null;for(;null!=t.m_parent;){if(t.m_parent instanceof p){e=t.m_parent;break}t=t.m_parent}return e}set spacing(t){this.m_spacing=t,this.m_dirty=!0}set margins(t){this.m_margins.left=t,this.m_margins.top=t,this.m_margins.right=t,this.m_margins.bottom=t,this.m_dirty=!0}get margins(){return this.m_margins}set width(t){this.m_width=t,this.m_dirty=!0}set height(t){this.m_height=t,this.m_dirty=!0}get width(){return this.m_parent instanceof p?this.m_parent.width:this.m_width}get height(){return this.m_parent instanceof p?this.m_parent.height:this.m_height}get recommendedWidth(){return 0}get recommendedHeight(){return 0}set dirty(t){this.m_dirty=t}get dirty(){return this.m_dirty}}class A extends W{constructor(t=h,e=null){super(e),this.m_orientation=t,this.m_items=[],this.m_fillers=[],this.m_usedWidth=0,this.m_usedHeight=0}get recommendedWidth(){if(this.m_dirty&&this.update(),this.m_orientation==n){const t=this.m_items.length-this.m_fillers.length;return this.m_usedWidth+this.m_margins.left+this.m_margins.right+(t-1)*this.m_spacing}{let t=0;for(let e of this.m_items)e.recommendedWidth>t&&(t=e.recommendedWidth);return t}}get recommendedHeight(){if(this.m_dirty&&this.update(),this.m_orientation==h){const t=this.m_items.length-this.m_fillers.length;return this.m_usedHeight+this.m_margins.top+this.m_margins.bottom+(t-1)*this.m_spacing}{let t=0;for(let e of this.m_items)e.recommendedHeight>t&&(t=e.recommendedHeight);return t}}removeWidget(t){let e=this.m_items.indexOf(t);-1!=e&&this.m_items.splice(e,1),e=this.m_fillers.indexOf(t),-1!=e&&this.m_fillers.splice(e,1),this.m_dirty=!0}addWidget(t,e=1){t instanceof p&&this.addItem(t,e)}addLayout(t,e=1){t instanceof W&&this.addItem(t,e)}addItem(t,e=1){this.removeWidget(t),this.m_items.push(t),e<=0&&this.m_fillers.push(t),t.stretch=e,this.m_dirty=!0,t instanceof W&&(t.m_parent=this)}addStretch(){this.addSpacer(0)}addSpacer(t){let e=new R;e.stretch=t,this.m_items.push(e),t<=0&&this.m_fillers.push(e),this.m_dirty=!0}update(t){if(null==this.m_parent)return void console.log("layout has no parent");if(!this.m_dirty)return;if(this.m_dirty=!1,0==this.m_items.length)for(let t of this.m_parent.m_children)this.m_items.push(t),t.stretch=1;let e=0,i=0;for(let t of this.m_items)t.visible&&(i++,e+=t.stretch);let s=0;for(let t of this.m_fillers)t.visible&&s++;const n=s>0,o=i-s;let l=this.parentWidget(this),r=0,m=0;if(this.m_parent instanceof p&&(r=this.m_parent.contentsMargins.left+this.m_parent.contentsMargins.right,m=this.m_parent.contentsMargins.top+this.m_parent.contentsMargins.bottom),this.m_orientation==h){let t=this.m_margins.left;this.m_parent instanceof p&&(t+=this.m_parent.contentsMargins.left),this.m_parent instanceof W&&(t+=this.x);const i=this.width-this.m_margins.left-this.m_margins.right-r,h=this.height-(o-1)*this.m_spacing-(this.m_margins.top+this.m_margins.bottom)-m;this.m_usedHeight=0;for(let s of this.m_items)if(s instanceof p&&s.parent!=l&&l instanceof p&&l.addChild(s),s.width=i,s.x=t,s.stretch>0){let t=Math.trunc(h*(s.stretch/e));n&&(t=s.recommendedHeight),s.height=t,t=s.height,this.m_usedHeight+=t}const a=h-this.m_usedHeight;for(let t of this.m_fillers)t.visible&&(t.height=Math.trunc(a/s-this.m_spacing));let _=this.m_margins.top;this.m_parent instanceof p&&(_+=this.m_parent.contentsMargins.top),this.m_parent instanceof W&&(_+=this.y);for(let t of this.m_items)t.height>0&&t.visible&&(t.y=_,_+=t.height+this.m_spacing)}else{let t=this.m_margins.top;this.m_parent instanceof p&&(t+=this.m_parent.contentsMargins.top),this.m_parent instanceof W&&(t+=this.y);const i=this.height-this.m_margins.top-this.m_margins.bottom-m,h=this.width-(o-1)*this.m_spacing-(this.m_margins.left+this.m_margins.right)-r;this.m_usedWidth=0;for(let s of this.m_items)if(s instanceof p&&s.parent!=l&&l instanceof p&&l.addChild(s),s.height=i,s.y=t,s.stretch>0){let t=Math.trunc(h*(s.stretch/e));n&&(t=s.recommendedWidth),s.width=t,t=s.width,this.m_usedWidth+=t}const a=h-this.m_usedWidth;for(let t of this.m_fillers)t.visible&&(t.width=Math.trunc(a/s-this.m_spacing));let _=this.m_margins.left;this.m_parent instanceof p&&(_+=this.m_parent.contentsMargins.left),this.m_parent instanceof W&&(_+=this.x);for(let t of this.m_items)t.width>0&&t.visible&&(t.x=_,_+=t.width+this.m_spacing)}for(let e of this.m_items)e instanceof W&&e.update(t)}}class L extends p{constructor(t){super(t),this.m_min=0,this.m_max=100,this.m_value=0}set value(t){t<this.m_min?this.m_value=this.m_min:t>this.m_max?this.m_value=this.m_max:this.m_value=t,this.onValueChanged()}get value(){return this.m_value}set maxValue(t){this.m_max=t,this.m_value>t&&(this.m_value=t),this.onMaxValueChanged()}get maxValue(){return this.m_max}set minValue(t){this.m_min=t,this.m_value<t&&(this.m_value=t),this.onMinValueChanged()}get minValue(){return this.m_min}onValueChanged(){}onMaxValueChanged(){}onMinValueChanged(){}}class O extends L{constructor(e=h,s=null){super(s),this.m_orientation=e,this.m_origValue=0,this.m_thumbSize=0,this.m_scrollOk=!1,this.m_origPos=0,this.m_thumbRect=new i(new t(0,0),new t(0,0)),this.m_callReceiver=!1,this.m_updateThumbPos=!0,this.focusable=!1,this.objectName="XScrollBar",this.m_hover,this.opacity=100}get recommendedWidth(){return this.m_orientation==h?5:300}get recommendedHeight(){return this.m_orientation==h?300:5}get orientation(){return this.m_orientation}set thumbSize(t){this.m_thumbSize=t,this.m_updateThumbPos=!0}get thumbSize(){return this.m_thumbSize}mouseDownEvent(t){this.m_thumbRect.containsPoint(t.localPos)?(this.m_scrollOk=!0,this.m_orientation==h?this.m_origPos=t.localPos.y:this.m_origPos=t.localPos.x,this.m_origValue=this.value):(this.m_orientation==h?this.value=this.minValue+t.localPos.y/this.m_height*(this.maxValue-this.minValue):this.value=this.minValue+t.localPos.x/this.m_width*(this.maxValue-this.minValue),this.m_callReceiver=!0),t.accept()}mouseUpEvent(t){this.m_scrollOk=!1}mouseMoveEvent(t){if(this.m_hover=this.m_thumbRect.containsPoint(t.localPos),this.m_scrollOk){let e=0;const i=this.maxValue-this.minValue;e=this.m_orientation==h?this.m_height>i?this.m_origValue+t.localPos.y-this.m_origPos:this.m_origValue+(t.localPos.y-this.m_origPos)/this.m_height*i:this.m_width>i?this.m_origValue+t.localPos.x-this.m_origPos:this.m_origValue+(t.localPos.x-this.m_origPos)/this.m_width*i,this.value=Math.trunc(e),this.m_callReceiver=!0,t.accept()}}mouseLeaveEvent(){this.m_hover=!1}wheelEvent(t){this.value+=t.deltaY,this.m_callReceiver=!0,t.accept()}update(t){if(this.m_visible){if(this.m_updateThumbPos||this.m_dirty){if(this.maxValue,this.minValue,this.m_orientation==h){const t=(this.m_height-this.m_thumbSize)*((this.value-this.minValue)/(this.maxValue-this.minValue));this.m_thumbRect.min.x=0,this.m_thumbRect.min.y=t,this.m_thumbRect.max.x=this.m_width-0,this.m_thumbRect.max.y=t+this.m_thumbSize}else{const t=(this.m_width-this.m_thumbSize)*((this.value-this.minValue)/(this.maxValue-this.minValue));this.m_thumbRect.min.x=t,this.m_thumbRect.min.y=0,this.m_thumbRect.max.x=t+this.m_thumbSize,this.m_thumbRect.max.y=this.m_height-0}this.m_updateThumbPos=!1}super.update(t),this.m_callReceiver&&(this.invokeEvent("valueChanged"),this.m_callReceiver=!1)}}draw(){if(!this.m_visible)return;this.applyTransformToContext(),this.clipStart(),this.m_width,p.DEVICE_PIXEL_RATIO,this.m_height,p.DEVICE_PIXEL_RATIO;const t=p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.style.active.widget,this.m_context.lineWidth=t;let e=null;e=this.enabled?this.m_scrollOk?"rgba(180,180,180,":this.m_hover?"rgba(190,190,190,":"rgba(200,200,200,":"rgba(200,200,200,";let i=e+this.opacity/100+")";this.m_context.fillStyle=i;const s=this.m_thumbRect.x*p.DEVICE_PIXEL_RATIO,h=this.m_thumbRect.y*p.DEVICE_PIXEL_RATIO,n=this.m_thumbRect.width*p.DEVICE_PIXEL_RATIO,o=this.m_thumbRect.height*p.DEVICE_PIXEL_RATIO;this.m_context.fillRect(s,h,n,o),this.clipEnd()}onValueChanged(){this.m_updateThumbPos=!0}onMaxValueChanged(){this.m_updateThumbPos=!0}onMaxValueChanged(){this.m_updateThumbPos=!0}}class M{constructor(){this.m_singleShot=!1,this.m_interval=10,this.m_timerId=-1,this.m_action=null}set interval(t){this.m_interval=t}get interval(){return this.m_interval}set singleShot(t){this.m_singleShot=t}get singleShot(){return this.m_singleShot}get isRunning(){return-1!=this.m_timerId}set action(t){this.m_action=t}start(){this.isRunning&&this.stop();const t=Math.max(10,this.m_interval);this.m_singleShot?this.m_timerId=setTimeout((function(t){"function"==typeof t&&t()}),t,this.m_action):this.m_timerId=setInterval((function(e){"function"==typeof e&&e(t)}),t,this.m_action)}stop(){this.isRunning&&(this.m_singleShot?clearTimeout(this.m_timerId):clearInterval(this.m_timerId),this.m_timerId=-1)}}class D extends P{constructor(t){super(t),this.m_scrollWidget=null,this.m_contentsWidget=new p(this),this.m_contentsWidget.addEventListener("widthChanged",this),this.m_contentsWidget.addEventListener("heightChanged",this),this.m_contentsWidget.focusable=!1,this.addChild(this.m_contentsWidget),this.m_scrollY=0,this.m_scrollX=0,this.m_origScrollY=0,this.m_origScrollX=0,this.m_scrollOk=!1,this.m_startScrollPos={},this.m_callOnWidgetScroll=!1,this.m_vertScrollBar=new O(h,this),this.m_vertScrollBar.addEventListener("valueChanged",this),this.m_vertScrollBar.visible=!1,this.m_horiScrollBar=new O(n,this),this.m_horiScrollBar.addEventListener("valueChanged",this),this.m_horiScrollBar.visible=!1,this.m_vertScrollBarPolicy=0,this.m_horiScrollBarPolicy=0,this.m_dontUpdateSb=!1,this.m_maxChanged=!1,this.m_policyChanged=!0,this.m_maxScrollX=0,this.m_maxScrollY=0,this.m_viewportMargin=2,this.m_scrollBarThickness=10,this.m_embedScrollBar=!0,this.m_enableAnimation=!0,this.m_embedScrollBar&&(this.m_enableAnimation?(this.m_vertScrollBar.opacity=0,this.m_horiScrollBar.opacity=0):(this.m_vertScrollBar.opacity=80,this.m_horiScrollBar.opacity=80)),this.m_animationElapsed=0,this.m_animationDuration=300,this.m_timer=new M,this.m_timer.action=this.animate.bind(this)}get recommendedWidth(){return 300}get recommendedHeight(){return 300}set scrollWidget(t){null!=this.m_scrollWidget&&(this.m_contentsWidget.removeChild(this.m_scrollWidget),this.m_scrollWidget.removeEventListener("widthChanged",this),this.m_scrollWidget.removeEventListener("heightChanged",this)),null!=t&&(this.m_scrollWidget=t,this.m_contentsWidget.addChild(t),this.m_vertScrollBar.raise(),this.m_horiScrollBar.raise(),this.m_scrollWidget.addEventListener("widthChanged",this),this.m_scrollWidget.addEventListener("heightChanged",this))}get scrollWidget(){return this.m_scrollWidget}set embedScrollBar(t){this.m_embedScrollBar=t,this.m_dirty=!0}set scrollBarThickness(t){this.m_scrollBarThickness=5,this.m_dirty=!0}set viewportMargin(t){this.m_viewportMargin=t,this.m_dirty=!0}get viewportMargin(){return this.m_viewportMargin}customEvent(t,e,i){if(t==this.m_scrollWidget||t==this.m_contentsWidget)switch(e){case"widthChanged":case"heightChanged":this.m_maxChanged=!0,this.updateScrollBars(),this.invokeEvent("maxScrollValueChanged")}else t==this.m_vertScrollBar?"valueChanged"==e&&(this.m_dontUpdateSb=!0,this.scrollY=this.m_vertScrollBar.value,this.m_callOnWidgetScroll=!0):t==this.m_horiScrollBar&&"valueChanged"==e&&(this.m_dontUpdateSb=!0,this.scrollX=this.m_horiScrollBar.value,this.m_callOnWidgetScroll=!0)}ensureVisible(t){this.scrollX=t.x+t.width/2,this.scrollY=t.y+t.height/2}updateMax(){this.m_maxChanged=!0}mouseDownEvent(t){this.m_scrollOk=!0,this.m_startScrollPos=t.globalPos,this.m_origScrollX=this.m_scrollX,this.m_origScrollY=this.m_scrollY,t.accept()}mouseUpEvent(t){this.m_scrollOk=!1}mouseMoveEvent(t){if(this.m_scrollOk){const e=t.globalPos.x-this.m_startScrollPos.x,i=t.globalPos.y-this.m_startScrollPos.y;this.scrollX=this.m_origScrollX-e,this.scrollY=this.m_origScrollY-i,this.m_callOnWidgetScroll=!0,t.accept()}}animate(t){this.m_animationElapsed+=t;let e=500==this.m_animationDuration,i=0;i=e?l.lerp(0,80,this.m_animationElapsed/this.m_animationDuration,l.easeOutCirc):l.lerp(80,0,this.m_animationElapsed/this.m_animationDuration,l.easeOutCirc),this.m_animationElapsed>=this.m_animationDuration&&(i=e?80:0,this.m_animationElapsed=0,this.m_timer.stop()),this.m_vertScrollBar.opacity=i,this.m_horiScrollBar.opacity=i}mouseEnterEvent(){this.m_embedScrollBar&&this.m_enableAnimation&&(this.m_animationDuration=500,this.m_animationElapsed=0,this.m_timer.start())}mouseLeaveEvent(){this.m_embedScrollBar&&this.m_enableAnimation&&(this.m_animationDuration=1e3,this.m_animationElapsed=0,this.m_timer.start())}wheelEvent(t){this.scrollY+=t.deltaY,t.accept()}set verticalScrollBarPolicy(t){this.m_vertScrollBarPolicy=t,this.m_policyChanged=!0}set horizontalScrollBarPolicy(t){this.m_horiScrollBarPolicy=t,this.m_policyChanged=!0}get scrollX(){return this.m_scrollX}get scrollY(){return this.m_scrollY}set maxScrollX(t){this.m_maxScrollX=Math.max(t,0)}get maxScrollX(){if(null!=this.m_scrollWidget){const t=this.m_scrollWidget.width-this.m_contentsWidget.width;return t<0?0:t}return 0}set maxScrollY(t){this.m_maxScrollY=Math.max(t,0)}get maxScrollY(){if(null!=this.m_scrollWidget){const t=this.m_scrollWidget.height-this.m_contentsWidget.height;return t<0?0:t}return 0}set scrollX(t){const e=this.maxScrollX;this.m_scrollX=t<0?0:t>e?e:t,null!=this.m_scrollWidget&&(this.m_scrollWidget.x=-this.m_scrollX),this.m_scrollX==this.m_horiScrollBar.value||this.m_dontUpdateSb||(this.m_horiScrollBar.value=this.m_scrollX),this.m_dontUpdateSb=!1,this.invokeEvent("horizontalScrollChanged")}set scrollY(t){const e=this.maxScrollY;this.m_scrollY=t<0||e<0?0:t>e?e:t,null!=this.m_scrollWidget&&(this.m_scrollWidget.y=-this.m_scrollY),this.m_scrollY==this.m_vertScrollBar.value||this.m_dontUpdateSb||(this.m_vertScrollBar.value=this.m_scrollY),this.m_dontUpdateSb=!1,this.invokeEvent("verticalScrollChanged")}onWidgetScroll(){}updateScrollBars(){this.m_vertScrollBar.maxValue=this.maxScrollY,1!=this.m_vertScrollBarPolicy&&(this.m_vertScrollBar.visible=this.maxScrollY>0||2==this.m_vertScrollBarPolicy),this.m_horiScrollBar.maxValue=this.maxScrollX,1!=this.m_horiScrollBarPolicy&&(this.m_horiScrollBar.visible=this.maxScrollX>0||2==this.m_horiScrollBarPolicy),this.scrollY>this.maxScrollY&&(this.scrollY=this.maxScrollY),this.scrollX>this.maxScrollX&&(this.scrollX=this.maxScrollX),this.scrollY!=this.m_vertScrollBar.value&&(this.m_vertScrollBar.value=this.scrollY),this.m_scrollX!=this.m_horiScrollBar.value&&(this.m_horiScrollBar.value=this.m_scrollX),Math.max(3,this.m_viewportMargin);let t=0;if(this.m_horiScrollBar.visible&&!this.m_embedScrollBar&&(t=this.m_scrollBarThickness),this.m_vertScrollBar.height=this.m_height-t-1,null!=this.m_scrollWidget){const t=this.m_contentsWidget.height/this.m_scrollWidget.height;this.m_vertScrollBar.thumbSize=Math.max(this.m_vertScrollBar.height*t,40)}let e=0;if(this.m_vertScrollBar.visible&&!this.m_embedScrollBar&&(e=this.m_scrollBarThickness),this.m_horiScrollBar.width=this.m_width-e-1,null!=this.m_scrollWidget){const t=this.m_contentsWidget.width/this.m_scrollWidget.width;this.m_horiScrollBar.thumbSize=Math.max(this.m_horiScrollBar.width*t,40)}}update(t){const e=this.m_dirty;if(super.update(t),this.m_dirty=!1,this.m_callOnWidgetScroll&&this.onWidgetScroll(),this.m_callOnWidgetScroll=!1,(this.m_policyChanged||e||this.m_vertScrollBar.maxValue!=this.maxScrollY||this.m_horiScrollBar.maxValue!=this.maxScrollX)&&this.updateScrollBars(),e||this.m_maxChanged||this.m_policyChanged){if(this.m_contentsWidget.x=this.m_viewportMargin,this.m_contentsWidget.y=this.m_viewportMargin,this.m_embedScrollBar)this.m_contentsWidget.width=this.width-2*this.m_viewportMargin,this.m_contentsWidget.height=this.height-2*this.m_viewportMargin;else{let t=this.m_viewportMargin+1;this.m_vertScrollBar.visible&&(t+=this.m_scrollBarThickness);let e=this.m_viewportMargin+1;this.m_horiScrollBar.visible&&(e+=this.m_scrollBarThickness),this.m_contentsWidget.width=this.width-t,this.m_contentsWidget.height=this.height-e}this.m_vertScrollBar.y=1,this.m_vertScrollBar.width=this.m_scrollBarThickness,this.m_vertScrollBar.x=this.m_width-this.m_vertScrollBar.width,this.m_horiScrollBar.x=1,this.m_horiScrollBar.height=this.m_scrollBarThickness,this.m_horiScrollBar.y=this.m_height-this.m_horiScrollBar.height,this.m_policyChanged=!1,this.m_maxChanged=!1}}}class V{constructor(){this.m_lines=[""]}get length(){return this.m_lines.length}insert(t,e){this.m_lines.splice(t,0,e)}remove(t,e=1){this.m_lines.splice(t,e)}set(t,e){this.m_lines[t]=e}at(t){return this.m_lines[t]}push(t){this.m_lines.push(t)}clear(){this.m_lines=[]}setLines(t){this.m_lines=t}}class X{constructor(e,i=null){this.m_startCursorPos=new t(0,0),this.m_endCursorPos=new t(0,0),this.m_startCursorPos.x=e.x,this.m_startCursorPos.y=e.y,null!=i&&(this.m_endCursorPos.x=i.x,this.m_endCursorPos.y=i.y),this.m_preCommand=null,this.m_postCommand=null}doAction(t){}undoAction(t){}}class B extends X{constructor(t,e){super(e),this.m_text=t}doAction(e){let i=new t;i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,null!=this.m_preCommand&&(i=this.m_preCommand.doAction(e));let s="";return i.y<e.length&&(s=e.at(i.y)),s=s.substring(0,i.x)+this.m_text+s.substring(i.x),e.set(i.y,s),new t(i.x+this.m_text.length,i.y)}undoAction(e){let i=new t;if(i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,null!=this.m_preCommand){i=this.m_preCommand.undoAction(e);let t="";i.y<e.length&&(t=e.at(i.y)),t=i.x==t.length?t.substring(0,i.x-this.m_text.length):t.substring(0,i.x)+t.substring(i.x+this.m_text.length),e.set(i.y,t)}else{let t="";i.y<e.length&&(t=e.at(i.y)),t=t.substring(0,i.x)+t.substring(i.x+this.m_text.length),e.set(i.y,t)}return i}}class H extends X{constructor(t,e){super(t,e),this.m_deletedChar="",this.m_prevCursorX=0}doAction(e){let i="",s=new t;return s.x=this.m_startCursorPos.x,s.y=this.m_startCursorPos.y,this.m_prevCursorX=-1,s.y<e.length&&(i=e.at(s.y)),i.length>0&&s.x>0?(this.m_deletedChar=i.substr(s.x-1,1),i=i.slice(0,s.x-1)+i.slice(s.x),e.set(s.y,i),s.x--,this.m_prevCursorX=s.x):s.y>0&&(e.at(s.y-1).length>0?(s.x=e.at(s.y-1).length,this.m_prevCursorX=s.x,this.m_prevCursorX=s.x,i=e.at(s.y-1),i+=e.at(s.y),e.set(s.y-1,i),e.remove(s.y)):e.remove(s.y-1),this.m_deletedChar="\n",s.y--),s}undoAction(e){let i=new t;if(i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,"\n"==this.m_deletedChar){let t="";if(i.y-1<e.length&&(t=e.at(i.y-1)),t.length==this.m_prevCursorX)e.insert(i.y,"");else{let s=t.substr(0,this.m_prevCursorX),h=t.substr(this.m_prevCursorX);e.set(i.y-1,s),h.length>0?e.insert(i.y,h):e.insert(i.y-1,"")}}else{let t="";i.y<e.length&&(t=e.at(i.y)),t=t.substr(0,this.m_prevCursorX)+this.m_deletedChar+t.substr(this.m_prevCursorX),e.set(i.y,t),i.x=this.m_prevCursorX+1}return i}}class k extends X{constructor(t,e){super(t,e)}doAction(e){let i=new t;i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,null!=this.m_preCommand&&(i=this.m_preCommand.doAction(e));let s="";i.y<e.length&&(s=e.at(i.y));let h="";return s.length>0&&(h=s.substring(i.x),e.set(i.y,s.slice(0,i.x))),e.insert(i.y+1,h),i.x=0,i.y++,i}undoAction(e){let i=new t;if(i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,null!=this.m_preCommand){i=this.m_preCommand.undoAction(e);let t=e.at(i.y+1),s=e.at(i.y);s+=t,e.set(i.y,s),e.remove(i.y+1)}else{let t=e.at(i.y+1),s=e.at(i.y);i.x=s.length,s+=t,e.set(i.y,s),e.remove(i.y+1)}return i}}class G extends X{constructor(t,e){super(t,e),this.m_deletedText=""}doAction(e){let i=this.m_startCursorPos.x,s=this.m_startCursorPos.y,h=this.m_endCursorPos.x,n=this.m_endCursorPos.y;if(this.m_endCursorPos.y<this.m_startCursorPos.y&&(i=this.m_endCursorPos.x,s=this.m_endCursorPos.y,h=this.m_startCursorPos.x,n=this.m_startCursorPos.y),h<i&&(i=this.m_endCursorPos.x,h=this.m_startCursorPos.x),n==s){var o=e.at(s);""==this.m_deletedText&&(this.m_deletedText=o.substr(i,h-i)),o=o.slice(0,i)+o.slice(h),e.set(s,o)}else{let t=e.at(s).slice(0,i);if(""==this.m_deletedText){for(let t=s;t<=n;++t)this.m_deletedText+=t==s?e.at(t).substr(i):t==n?e.at(t).substr(0,h):e.at(t),t<n&&(this.m_deletedText+="\n");console.log("DELETE TEXT:"+this.m_deletedText)}let o=e.at(n).substr(h);e.insert(s,t+o),e.remove(s+1,n-s+1)}return new t(i,s)}undoAction(e){let i=this.m_startCursorPos.x,s=this.m_startCursorPos.y,h=this.m_endCursorPos.x,n=this.m_endCursorPos.y;if(this.m_endCursorPos.y<this.m_startCursorPos.y&&(i=this.m_endCursorPos.x,s=this.m_endCursorPos.y,h=this.m_startCursorPos.x,n=this.m_startCursorPos.y),h<i&&(i=this.m_endCursorPos.x,h=this.m_startCursorPos.x),n==s){var o=e.at(s);o=o.substring(0,i)+this.m_deletedText+o.substring(i),e.set(s,o)}else{let t=this.m_deletedText.split("\n"),o="";s<e.length&&(o=e.at(s));let l="",r="";o.length>0&&(l=o.substring(0,i),r=o.substring(i));let m=!0;for(let i of t)i=i.replace(/(\r\n|\n|\r)/gm,""),m?(m=!1,e.set(s,l+i)):(s++,e.insert(s,i));s<e.length&&(o=e.at(s)),r.length>0&&(o+=r,e.set(s,o)),h=e.at(s).length,n=s}return new t(h,n)}}class N extends X{constructor(t,e,i,s){super(i,s),this.m_text=e,this.m_multiLine=t}doAction(e){let i=new t;if(i.x=this.m_startCursorPos.x,i.y=this.m_startCursorPos.y,null!=this.m_preCommand&&(i=this.m_preCommand.doAction(e),this.m_startCursorPos.x=i.x,this.m_startCursorPos.y=i.y),!this.m_multiLine){let t="";return i.y<e.length&&(t=e.at(i.y)),t=t.substring(0,i.x)+this.m_text+t.substring(i.x),e.set(i.y,t),i.x+=this.m_text.length,this.m_endCursorPos.x=i.x,this.m_endCursorPos.y=i.y,i}let s=this.m_text.split("\n"),h="";i.y<e.length&&(h=e.at(i.y));let n="",o="";h.length>0&&(n=h.substring(0,i.x),o=h.substring(i.x));let l=!0;for(let t of s)t=t.replace(/(\r\n|\n|\r)/gm,""),l?(l=!1,e.set(i.y,n+t)):(i.y++,e.insert(i.y,t));return i.y<e.length&&(h=e.at(i.y)),o.length>0&&(h+=o,e.set(i.y,h)),i.x=e.at(i.y).length,this.m_endCursorPos.x=i.x,this.m_endCursorPos.y=i.y,console.log("PASTE***************"),console.log("start "+this.m_startCursorPos.x+" "+this.m_startCursorPos.y),console.log("end "+this.m_endCursorPos.x+" "+this.m_endCursorPos.y),i}undoAction(e){let i=this.m_startCursorPos.x,s=this.m_startCursorPos.y,h=this.m_endCursorPos.x,n=this.m_endCursorPos.y;if(console.log("start"+i+" "+s),console.log("end"+h+" "+n),n==s){var o=e.at(s);o=o.slice(0,i)+o.slice(h),e.set(s,o)}else{let t=e.at(s).slice(0,i),o=e.at(n).substr(h);e.insert(s,t+o),e.remove(s+1,n-s+1)}if(null!=this.m_preCommand){let t=this.m_preCommand.undoAction(e);i=t.x,s=t.y}return new t(i,s)}}class z extends p{static HIDDEN_TEXTEDIT_CREATED=!1;constructor(e){if(super(e),this.m_lines=new V,this.textAlign="left",this.textBaseline="middle",this.m_cursorPos=new t(0,0),this.m_cursorPixelPos=new t(0,0),this.m_selectionStartPos=new t(0,0),this.m_selectionEndPos=new t(0,0),this.m_selectionStartPixelPos=new t(0,0),this.m_selectionEndPixelPos=new t(0,0),this.m_selectionMode=!1,this.m_shiftHold=!1,this.m_shiftStart=!1,this.m_autoScroll=!1,this.m_autoScrollTimer=0,this.m_updateCursorPixelPos=!1,this.m_textChanged=!1,this.m_multiLine=!0,this.m_lastGlobalY=-1,this.m_lastGlobalX=-1,this.m_leftMargin=0,this.m_rightMargin=5,this.m_cursorTimer=0,this.m_showCursor=!0,this.m_insertStarted=!1,this.m_insertTimer=0,this.m_insertCursorPos=new t(0,0),this.m_textToBeInserted="",this.m_textToBeAppended="",this.m_idleTimer=0,this.m_autoResize=!1,this.m_textAreaWidth=0,this.m_recalcTextAreaWidth=!1,this.m_updatedStartPos=new t(0,0),this.m_updatedEndPos=new t(0,0),this.m_wordWrap=!0,this.m_readOnly=!1,this.m_suffix="",this.m_prefix="",this.m_history=[],this.m_historyIndex=-1,this.m_maxHistory=500,!z.HIDDEN_TEXTEDIT_CREATED){z.HIDDEN_TEXTEDIT_CREATED=!0;let t=document.createElement("textarea");t.id="HIDDEN_TEXTEDIT",t.style.display="none",document.body.appendChild(t)}}set text(t){if(this.m_lines.setLines(t.split("\n")),this.m_lines.length>0){let t=this.m_lines.at(this.m_lines.length-1);this.m_cursorPos.x=t.length,this.m_cursorPos.y=this.m_lines.length-1}null==this.m_context?(this.m_textChanged=!0,this.recalcTextAreaWidth()):this.resizeTextArea()}append(t){let e=t.split("\n");for(let t of e)this.m_lines.push(t);null==this.m_context?(this.m_textChanged=!0,this.recalcTextAreaWidth()):this.resizeTextArea()}get text(){let t="";for(let e=0;e<this.m_lines.length;++e)t+=this.m_lines.at(e)+(this.m_multiLine?"\\n":"");return t}set readOnly(t){this.m_readOnly=t}get readOnly(){return this.m_readOnly}set suffix(t){this.m_suffix=t}get suffix(){return this.m_suffix}set prefix(t){this.m_prefix=t}get prefix(){return this.m_prefix}mouseEnterEvent(){this.enabled&&(this.m_canvas.style.cursor="text")}mouseLeaveEvent(){this.enabled&&(this.m_canvas.style.cursor="default")}moveCursorToLast(){this.m_cursorPos.y=this.m_lines.length-1;let t="";this.m_cursorPos.y<this.m_lines.length&&(t=this.m_lines.at(this.m_cursorPos.y)),this.m_cursorPos.x=t.length,this.m_selectionStartPos.x=this.m_cursorPos.x,this.m_selectionStartPos.y=this.m_cursorPos.y,this.m_selectionEndPos.x=this.m_cursorPos.x,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_selectionMode=!1,this.m_updateCursorPixelPos=!0}showKeyboard(){let t=document.getElementById("HIDDEN_TEXTEDIT");t.style.display="block",t.focus(),t.style.display="none"}focusEnterEvent(){console.log("focus enter textedit")}focusLeaveEvent(){console.log("focus leave textedit")}mouseDownEvent(t){if(!this.enabled)return;this.m_canvas.focus(),this.readOnly||this.showKeyboard();let e=t.localPos,i=this.getCursorPosY(e.y);this.m_cursorPos.y=i[0],this.m_cursorPixelPos.y=i[1];let s="";this.m_cursorPos.y<this.m_lines.length&&(s=this.m_lines.at(this.m_cursorPos.y));let h=this.getCursorPosX(s,e.x);this.m_cursorPos.x=h[0],this.m_cursorPixelPos.x=h[1],this.invokeEvent("cursorPosChanged"),this.m_shiftHold||(this.m_selectionStartPos.x=this.m_cursorPos.x,this.m_selectionStartPos.y=this.m_cursorPos.y,this.m_selectionStartPixelPos.x=this.m_cursorPixelPos.x,this.m_selectionStartPixelPos.y=this.m_cursorPixelPos.y),this.m_selectionEndPos.x=this.m_cursorPos.x,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_selectionEndPixelPos.x=this.m_cursorPixelPos.x,this.m_selectionEndPixelPos.y=this.m_cursorPixelPos.y,this.m_selectionMode=!0,t.accept()}mouseMoveEvent(t){this.enabled&&(this.m_selectionMode&&(this.m_lastGlobalX=t.globalPos.x,this.m_lastGlobalY=t.globalPos.y,this.m_autoScroll=!0,this.selectText(this.toLocal(t.globalPos))),t.accept())}mouseUpEvent(t){this.enabled&&(this.m_selectionMode=!1,this.m_autoScroll=!1)}selectText(t){let e=this.getCursorPosY(t.y);this.m_cursorPos.y=e[0],this.m_cursorPixelPos.y=e[1];let i="";if(this.m_cursorPos.y<this.m_lines.length&&(i=this.m_lines.at(this.m_cursorPos.y)),i.length>0){let e=this.getCursorPosX(i,t.x);this.m_cursorPos.x=e[0],this.m_cursorPixelPos.x=e[1]}else{var s;if("right"==this.textAlign||"end"==this.textAlign){if(s=this.m_width-this.m_rightMargin,!this.m_multiLine&&this.m_suffix.length>0){let t=this.getMetrics(" ");s-=this.getMetrics(this.m_suffix).width+t.width}}else if("center"==this.textAlign)s=this.m_width/2;else if(s=this.m_leftMargin,!this.m_multiLine&&this.m_prefix.length>0){let t=this.getMetrics(" ");s+=this.getMetrics(this.m_prefix).width+t.width}this.m_cursorPos.x=0,this.m_cursorPixelPos.x=s}this.invokeEvent("cursorPosChanged"),this.m_selectionEndPos.x=this.m_cursorPos.x,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_selectionEndPixelPos.x=this.m_cursorPixelPos.x,this.m_selectionEndPixelPos.y=this.m_cursorPixelPos.y}isWhiteSpace(t){return-1!=" \t\n\r\v".indexOf(t)}doubleClickEvent(t){if(this.enabled){var e="";if(this.m_cursorPos.y<this.m_lines.length&&(e=this.m_lines.at(this.m_cursorPos.y)),0!=e.length){if(this.m_selectionStartPos.y=this.m_cursorPos.y,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_cursorPos.x>0){this.m_selectionStartPos.x=0;for(let t=this.m_cursorPos.x-1;t>=0;--t)if(t<e.length&&this.isWhiteSpace(e[t])){this.m_selectionStartPos.x=t+1;break}this.m_selectionEndPos.x=e.length;for(let t=this.m_cursorPos.x;t<e.length;++t)if(this.isWhiteSpace(e[t])){this.m_selectionEndPos.x=t;break}this.m_cursorPos.x=this.m_selectionEndPos.x,this.m_selectionStartPixelPos=this.getCursorPixelPos(this.m_selectionStartPos),this.m_selectionEndPixelPos=this.getCursorPixelPos(this.m_selectionEndPos),this.m_cursorPixelPos=this.m_selectionEndPixelPos}t.accept()}}}keyUpEvent(t){this.enabled&&"Shift"===t.key&&(this.m_shiftHold=!1,this.m_shiftStart=!1)}_startArrowSelection(){this.m_shiftHold?this.m_shiftStart||(this.m_shiftStart=!0,this.m_selectionStartPos.x=this.m_cursorPos.x,this.m_selectionStartPos.y=this.m_cursorPos.y,this.m_selectionStartPixelPos=this.getCursorPixelPos(this.m_selectionStartPos),this.m_selectionEndPixelPos=this.getCursorPixelPos(this.m_selectionEndPos)):(this.m_selectionStartPos.x=this.m_cursorPos.x,this.m_selectionStartPos.y=this.m_cursorPos.y,this.m_selectionEndPos.x=this.m_cursorPos.x,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_shiftStart=!1)}_endArrowSelection(){this.m_shiftHold&&(this.m_selectionEndPos.x=this.m_cursorPos.x,this.m_selectionEndPos.y=this.m_cursorPos.y,this.m_selectionEndPixelPos=this.getCursorPixelPos(this.m_selectionEndPos))}keyDownEvent(t){if(!this.enabled)return;let e="";if(!(t.getModifierState("Fn")||t.getModifierState("Hyper")||t.getModifierState("OS")||t.getModifierState("Super")||t.getModifierState("Win"))){switch(t.key){case"ArrowUp":if(this.m_readOnly)return;this._startArrowSelection(),this.m_cursorPos.y>0&&this.m_cursorPos.y--,this.m_lines.at(this.m_cursorPos.y).length<this.m_cursorPos.x&&(this.m_cursorPos.x=this.m_lines.at(this.m_cursorPos.y).length),this._endArrowSelection();break;case"ArrowDown":if(this.m_readOnly)return;this._startArrowSelection(),this.m_cursorPos.y<this.m_lines.length-1&&this.m_cursorPos.y++,this.m_lines.at(this.m_cursorPos.y).length<this.m_cursorPos.x&&(this.m_cursorPos.x=this.m_lines.at(this.m_cursorPos.y).length),this._endArrowSelection();break;case"ArrowLeft":if(this.m_readOnly)return;this._startArrowSelection(),this.m_cursorPos.x>0&&this.m_cursorPos.x--,this._endArrowSelection();break;case"ArrowRight":if(this.m_readOnly)return;this._startArrowSelection(),this.m_cursorPos.y<this.m_lines.length&&(e=this.m_lines.at(this.m_cursorPos.y)),this.m_cursorPos.x<e.length&&this.m_cursorPos.x++,this._endArrowSelection();break;case"Backspace":if(this.m_readOnly)return;if(this.m_updatedStartPos.x=this.m_cursorPos.x,this.m_updatedStartPos.y=this.m_cursorPos.y,this.m_selectionStartPos.x!=this.m_selectionEndPos.x||this.m_selectionStartPos.y!=this.m_selectionEndPos.y)this.deleteSelected();else{let t=new H(this.m_cursorPos);this.doCommand(t)}this.m_updatedEndPos.x=this.m_cursorPos.x,this.m_updatedEndPos.y=this.m_cursorPos.y,this.m_textChanged=!0;break;case"Enter":if(this.m_readOnly)return;if(this.m_multiLine){this.m_updatedStartPos.x=this.m_cursorPos.x,this.m_updatedStartPos.y=this.m_cursorPos.y;let t=new k(this.m_cursorPos);this.m_selectionStartPos.x==this.m_selectionEndPos.x&&this.m_selectionStartPos.y==this.m_selectionEndPos.y||(t.m_preCommand=new G(this.m_selectionStartPos,this.m_selectionEndPos)),this.doCommand(t),this.m_selectionStartPos.x=0,this.m_selectionStartPos.y=0,this.m_selectionEndPos.x=0,this.m_selectionEndPos.y=0,this.m_updatedEndPos.x=this.m_cursorPos.x,this.m_updatedEndPos.y=this.m_cursorPos.y}this.invokeEvent("enterPressed");break;case"Escape":break;default:if(t.ctrlKey||t.metaKey){switch(t.key.toLowerCase()){case"c":console.log("copy"),this.copy();break;case"v":if(this.m_readOnly)return;console.log("paste"),this.paste(),this.m_updateCursorPixelPos=!0;break;case"a":console.log("select all"),this.selectAll();break;case"x":if(this.m_readOnly)return;console.log("cut"),this.cut();break;case"z":this.undo();break;case"y":this.redo()}return}if(t.altKey)return;if(t.shiftKey&&"Shift"==t.key)return void(this.m_shiftHold=!0);if(this.m_readOnly)return;this.m_updatedStartPos.x=this.m_cursorPos.x,this.m_updatedStartPos.y=this.m_cursorPos.y;let i=t.key;"Tab"==t.key&&(i="    ");let s=new B(i,this.m_cursorPos);this.m_selectionStartPos.x==this.m_selectionEndPos.x&&this.m_selectionStartPos.y==this.m_selectionEndPos.y||(s.m_preCommand=new G(this.m_selectionStartPos,this.m_selectionEndPos)),this.doCommand(s),this.m_selectionStartPos.x=0,this.m_selectionStartPos.y=0,this.m_selectionEndPos.x=0,this.m_selectionEndPos.y=0,this.m_textChanged=!0,this.m_updatedEndPos.x=this.m_cursorPos.x,this.m_updatedEndPos.y=this.m_cursorPos.y}this.m_updateCursorPixelPos=!0,this.invokeEvent("keyDown",t.key)}}deleteSelected(){if(this.m_selectionStartPos.x!=this.m_selectionEndPos.x||this.m_selectionStartPos.y!=this.m_selectionEndPos.y){let t=new G(this.m_selectionStartPos,this.m_selectionEndPos);return this.doCommand(t),this.m_selectionStartPos.x=0,this.m_selectionStartPos.y=0,this.m_selectionEndPos.x=0,this.m_selectionEndPos.y=0,!0}return!1}textHeight(){const t=this.getMetrics("|_");return t.actualBoundingBoxAscent+t.actualBoundingBoxDescent+3}getSelectedText(){if(this.m_selectionStartPos.x!=this.m_selectionEndPos.x||this.m_selectionStartPos.y!=this.m_selectionEndPos.y){let t=this.m_selectionStartPos.x,e=this.m_selectionStartPos.y,i=this.m_selectionEndPos.x,s=this.m_selectionEndPos.y;if(this.m_selectionEndPos.y<this.m_selectionStartPos.y&&(t=this.m_selectionEndPos.x,e=this.m_selectionEndPos.y,i=this.m_selectionStartPos.x,s=this.m_selectionStartPos.y),s==e)return i<t&&(t=this.m_selectionEndPos.x,i=this.m_selectionStartPos.x),this.m_lines.at(e).substring(t,i);{let h="";for(let n=e;n<=s;++n){let o=this.m_lines.at(n);this.getMetrics(o),n==e?(h+=o.substring(t),h+="\n"):n==s?h+=o.substring(0,i):(h+=o,h+="\n")}return h}}return""}cut(){this.copy(),this.deleteSelected()}doCommand(t){this.m_history.length-1>this.m_historyIndex&&this.m_history.length>0&&this.m_history.splice(this.m_historyIndex+1,this.m_history.length-this.m_historyIndex+1),this.m_history.length>this.m_maxHistory&&this.m_history.shift(),this.m_cursorPos=t.doAction(this.m_lines),this.m_history.push(t),this.m_historyIndex=this.m_history.length-1,this.m_updateCursorPixelPos=!0,this.m_textChanged=!0}undo(){if(this.m_historyIndex>=0){let t=this.m_history[this.m_historyIndex];this.m_cursorPos=t.undoAction(this.m_lines),this.m_historyIndex--,this.m_textChanged=!0,this.m_updateCursorPixelPos=!0}else console.log("history is empty")}redo(){if(this.m_historyIndex<this.m_history.length-1){this.m_historyIndex++;let t=this.m_history[this.m_historyIndex];this.m_cursorPos=t.doAction(this.m_lines),this.m_textChanged=!0,this.m_updateCursorPixelPos=!0}else console.log("history is latest")}async paste(){try{const t=await navigator.clipboard.readText();this.m_updatedStartPos.x=this.m_cursorPos.x,this.m_updatedStartPos.y=this.m_cursorPos.y;let e=new N(this.m_multiLine,t,this.m_cursorPos);this.m_selectionStartPos.x==this.m_selectionEndPos.x&&this.m_selectionStartPos.y==this.m_selectionEndPos.y||(e.m_preCommand=new G(this.m_selectionStartPos,this.m_selectionEndPos)),this.doCommand(e),this.m_selectionStartPos.x=0,this.m_selectionStartPos.y=0,this.m_selectionEndPos.x=0,this.m_selectionEndPos.y=0,this.m_updatedEndPos.x=this.m_cursorPos.x,this.m_updatedEndPos.y=this.m_cursorPos.y}catch(t){console.error("Failed to read clipboard contents: ",t)}}copy(){const t="text/plain",e=new Blob([this.getSelectedText()],{type:t});let i=[new ClipboardItem({[t]:e})];navigator.clipboard.write(i).then((function(){console.log("copy ok")}),(function(){console.log("Oops, unable to copy")}))}selectAll(){this.m_selectionStartPos.x=0,this.m_selectionStartPos.y=0,this.m_lines.length>0?(this.m_selectionEndPos.x=this.m_lines.at(this.m_lines.length-1).length,this.m_selectionEndPos.y=this.m_lines.length-1):(this.m_selectionEndPos.x=0,this.m_selectionEndPos.y=0),this.m_selectionStartPixelPos=this.getCursorPixelPos(this.m_selectionStartPos),this.m_selectionEndPixelPos=this.getCursorPixelPos(this.m_selectionEndPos)}getCursorPixelPos(t){var e={x:0,y:0};let i="";if(this.m_insertStarted){let t="";this.m_cursorPos.y<this.m_lines.length&&(t=this.m_lines.at(this.m_cursorPos.y)),i=t.substring(0,this.m_insertCursorPos.x)+this.m_textToBeInserted+this.m_textToBeAppended}else t.y<this.m_lines.length&&(i=this.m_lines.at(t.y));var s;if("right"==this.textAlign||"end"==this.textAlign){let t=this.getMetrics(i);if(s=this.m_width-t.width-this.m_rightMargin,!this.m_multiLine&&this.m_suffix.length>0){let e=this.getMetrics(" ");t=this.getMetrics(this.m_suffix),s-=t.width+e.width}}else if("center"==this.textAlign){let t=this.getMetrics(i);s=this.m_width/2-t.width/2}else if(s=this.m_leftMargin,!this.m_multiLine&&this.m_prefix.length>0){let t=this.getMetrics(" ");s+=this.getMetrics(this.m_prefix).width+t.width}if(t.x<=0)e.x=s;else if(t.x>=i.length){let t=this.getMetrics(i);e.x=s+t.width}else{let h=s,n=0;for(let e of i)if(++n,h+=this.getMetrics(e).width,n>=t.x)break;e.x=h}const h=this.textHeight();for(let i=0;i<t.y;++i)e.y+=h;return e}getCursorPosX(t,e){var i;if("right"==this.textAlign||"end"==this.textAlign){let e=this.getMetrics(t);if(i=this.m_width-e.width-this.m_rightMargin,!this.m_multiLine&&this.m_suffix.length>0){let t=this.getMetrics(" ");e=this.getMetrics(this.m_suffix),i-=e.width+t.width}}else if("center"==this.textAlign){let e=this.getMetrics(t);i=this.m_width/2-e.width/2}else if(i=this.m_leftMargin,!this.m_multiLine&&this.m_prefix.length>0){let t=this.getMetrics(" ");i+=this.getMetrics(this.m_prefix).width+t.width}if(e<=0)return[0,i];let s=i,h=0;for(let i of t){const t=this.getMetrics(i).width;if(s+t-t/2>e)break;s+=t,++h}return[h,s]}getCursorPosY(t){if(t<=0)return[0,0];const e=this.textHeight();let i=0,s=0;for(let h=0;h<this.m_lines.length-1;++h){let h=s+e;if(h>=t)break;s=h,++i}return[i,s]}parentResizeEvent(){this.resizeTextArea()}recalcTextAreaWidth(){this.m_recalcTextAreaWidth=!0,this.m_textAreaWidth=0}resizeTextArea(){let t=0,e=0;if(e=this.textHeight()*this.m_lines.length,this.m_recalcTextAreaWidth||!this.m_multiLine)for(let e=0;e<this.m_lines.length;++e){let i=this.m_lines.at(e);this.m_insertStarted&&e==this.m_insertCursorPos.y&&(i+=this.m_textToBeInserted+this.m_textToBeAppended);const s=this.getMetrics(i);s.width>t&&(t=s.width)}else{t=this.m_textAreaWidth;let e=this.m_updatedStartPos.y,i=this.m_updatedEndPos.y;e>i&&(e=this.m_updatedEndPos.y,i=this.m_updatedStartPos.y);for(let s=e;s<=i;++s){let e=this.m_lines.at(s);this.m_insertStarted&&s==this.m_insertCursorPos.y&&(e+=this.m_textToBeInserted+this.m_textToBeAppended);const i=this.getMetrics(e);i.width>t&&(t=i.width)}this.m_updatedStartPos.y=0,this.m_updatedEndPos.y=0}if(this.m_prefix.length>0){const e=this.getMetrics(this.m_prefix),i=this.getMetrics(" ");t+=e.width+i.width}if(this.m_suffix.length>0){let e=this.getMetrics(this.m_suffix);const i=this.getMetrics(" ");t+=e.width+i.width}const i=this.getMetrics("|");this.m_recalcTextAreaWidth=!1,this.m_textAreaWidth=t;let s=this.width,h=this.height,n=Math.max(t+i.width,this.m_parent.width),o=Math.max(e,this.m_parent.height);this.width=n,this.height=o,s==n&&h==o||this.invokeEvent("textAreaChanged",{oldWidth:s,oldHeight:h})}insertText(){if(this.m_insertStarted){let t="";this.m_insertCursorPos.y<this.m_lines.length&&(t=this.m_lines.at(this.m_insertCursorPos.y)),t=t.substring(0,this.m_insertCursorPos.x)+this.m_textToBeInserted+this.m_textToBeAppended,this.m_lines.set(this.m_insertCursorPos.y,t),this.m_textChanged=!0,this.m_insertStarted=!1,this.m_textToBeInserted="",this.m_textToBeAppended=""}}update(e){if(this.m_insertStarted&&(this.m_insertTimer+=e,this.m_insertTimer>=500&&(this.insertText(),this.m_insertTimer=0)),this.m_textChanged?(this.invokeEvent("textChanged"),this.resizeTextArea(),this.m_idleTimer=0,this.m_autoResize=!0):this.m_autoResize&&(this.m_idleTimer+=e,this.m_idleTimer>2e3&&(this.m_autoResize=!1,this.m_recalcTextAreaWidth=!0,this.resizeTextArea(),console.log("auto resize"))),this.m_dirty&&(this.m_selectionStartPixelPos=this.getCursorPixelPos(this.m_selectionStartPos),this.m_selectionEndPixelPos=this.getCursorPixelPos(this.m_selectionEndPos),this.m_cursorPixelPos=this.getCursorPixelPos(this.m_cursorPos)),this.m_readOnly||(this.m_cursorTimer+=e,this.m_cursorTimer>=500&&(this.m_cursorTimer=0,this.m_showCursor=!this.m_showCursor),this.m_showCursor=this.m_showCursor||this.m_updateCursorPixelPos||this.m_textChanged),this.m_textChanged&&(this.m_textChanged=!1),this.m_selectionMode&&!this.m_parent.boundary.containsPoint(new t(this.m_lastGlobalX,this.m_lastGlobalY))&&this.m_autoScroll&&(this.m_autoScrollTimer+=e,this.m_autoScrollTimer>30)){this.m_autoScrollTimer=0;let t=this.toLocalPoint(this.m_lastGlobalX,this.m_lastGlobalY);this.selectText(t)}this.m_updateCursorPixelPos&&(this.m_cursorPixelPos=this.getCursorPixelPos(this.m_cursorPos),this.m_updateCursorPixelPos=!1,this.invokeEvent("cursorPosChanged")),super.update(e)}getMetrics(t){const e=this.style.fontSize;return this.m_context.font=e+"px "+this.style.fontName,this.m_context.measureText(t)}drawFrame(){}drawText(){this.m_context.textAlign=this.textAlign,this.m_context.textBaseline="middle";const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=(p.DEVICE_PIXEL_RATIO,p.DEVICE_PIXEL_RATIO,this.m_leftMargin*p.DEVICE_PIXEL_RATIO),s=this.m_rightMargin*p.DEVICE_PIXEL_RATIO,h=this.getMetrics(" ").width*p.DEVICE_PIXEL_RATIO;let n=0;!this.m_multiLine&&this.m_suffix.length>0&&(n=this.getMetrics(this.m_suffix).width*p.DEVICE_PIXEL_RATIO);let o=0;var l;!this.m_multiLine&&this.m_prefix.length>0&&(o=this.getMetrics(this.m_prefix).width*p.DEVICE_PIXEL_RATIO),l="right"==this.m_context.textAlign||"end"==this.m_context.textAlign?t-s:"center"==this.m_context.textAlign?t/2:i;const r=this.textHeight()*p.DEVICE_PIXEL_RATIO;var m;m="bottom"==this.m_context.textBaseline||"alphabetic"==this.m_context.textBaseline?0:"middle"==this.m_context.textBaseline?this.m_multiLine?r/2:e/2:0,this.m_context.fillStyle=this.enabled?this.style.active.text:this.style.disabled.text;const a=this.y,_=this.m_parent.height,d=this.getCursorPosY(Math.abs(a)),c=this.getCursorPosY(_+Math.abs(a));m+=r*d[0];const u=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=u+"px "+this.style.fontName;for(let t=d[0];t<=c[0];++t){const e=this.m_lines.at(t);let i=0;if(o>0||n>0){i=this.getMetrics(e).width*p.DEVICE_PIXEL_RATIO;const t=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=t+"px "+this.style.fontName}!this.m_multiLine&&o>0&&("right"==this.m_context.textAlign?this.m_context.fillText(this.m_prefix,l-i-o-h,m):"center"==this.m_context.textAlign?this.m_context.fillText(this.m_prefix,l-i/2-o/2-h,m):(this.m_context.fillText(this.m_prefix,l,m),l+=o+h)),"right"==this.m_context.textAlign&&n>0&&(l-=n+h),this.m_context.fillText(e,l,m),!this.m_multiLine&&n>0&&("right"==this.m_context.textAlign?l+=n+h:"center"==this.m_context.textAlign?l+=+i/2+n/2+h:l+=i+h,this.m_context.fillText(this.m_suffix,l,m)),m+=r}this.m_insertStarted}drawSelection(){if(this.m_selectionEndPos.x==this.m_selectionStartPos.x&&this.m_selectionEndPos.y==this.m_selectionStartPos.y)return;let t=this.m_selectionStartPos.x,e=this.m_selectionStartPos.y,i=this.m_selectionEndPos.x,s=this.m_selectionEndPos.y,h=this.m_selectionStartPixelPos.x,n=this.m_selectionStartPixelPos.y,o=this.m_selectionEndPixelPos.x,l=this.m_selectionEndPixelPos.y;this.m_selectionEndPos.y<this.m_selectionStartPos.y?(t=this.m_selectionEndPos.x,e=this.m_selectionEndPos.y,i=this.m_selectionStartPos.x,s=this.m_selectionStartPos.y,h=this.m_selectionEndPixelPos.x,n=this.m_selectionEndPixelPos.y,o=this.m_selectionStartPixelPos.x,l=this.m_selectionStartPixelPos.y):this.m_selectionEndPos.y==this.m_selectionStartPos.y&&this.m_selectionEndPos.x<this.m_selectionStartPos.x&&(t=this.m_selectionEndPos.x,i=this.m_selectionStartPos.x,h=this.m_selectionEndPixelPos.x,o=this.m_selectionStartPixelPos.x);const r=this.getCursorPosY(Math.abs(this.y)),m=this.getCursorPosY(this.m_parent.height+Math.abs(this.y));e=Math.max(r[0]-1,e),s=Math.min(m[0]+1,s),n=Math.max(r[1],n),l=Math.min(m[1],l),this.m_context.fillStyle=this.style.active.highlighted;const a=this.textHeight()*p.DEVICE_PIXEL_RATIO;h*=p.DEVICE_PIXEL_RATIO,n*=p.DEVICE_PIXEL_RATIO,o*=p.DEVICE_PIXEL_RATIO,l*=p.DEVICE_PIXEL_RATIO,this.getMetrics(" ").width,p.DEVICE_PIXEL_RATIO;let _=1*p.DEVICE_PIXEL_RATIO;if(s==e)this.m_multiLine||(n=this.m_height*p.DEVICE_PIXEL_RATIO/2-a/2,_=0),this.m_context.fillRect(h,n-_,o-h,a+2*_);else{const t=this.width*p.DEVICE_PIXEL_RATIO,i=this.m_leftMargin*p.DEVICE_PIXEL_RATIO,r=this.m_rightMargin*p.DEVICE_PIXEL_RATIO,m=5*p.DEVICE_PIXEL_RATIO;var d;d="right"==this.textAlign||"end"==this.textAlign?t-r:"center"==this.textAlign?t/2:i;for(let c=e;c<=s;++c){const u=this.m_lines.at(c),g=this.getMetrics(u).width*p.DEVICE_PIXEL_RATIO;if(0!=u.length&&0!=g)if(c==e){let e=g+d-h-2*i;"center"==this.textAlign?e=g/2+d-h:"right"!=this.textAlign&&"end"!=this.textAlign||(e=t-h-r),e=Math.max(e,m),this.m_context.fillRect(h,n-_,e,a+2*_)}else if(c==s){let t=d,e=d+o-2*i;"center"==this.textAlign?(t=d-g/2,e=g/2-d+o):"right"!=this.textAlign&&"end"!=this.textAlign||(t=d-g,e=g-d+o),e=Math.max(e,m),this.m_context.fillRect(t,l-_,e,a+2*_)}else{const t=this.getCursorPixelPos({x:0,y:c}),e=t.x*p.DEVICE_PIXEL_RATIO,i=t.y*p.DEVICE_PIXEL_RATIO,s=Math.max(g,m);this.m_context.fillRect(e,i-_,s,a+2*_)}else{const t=this.getCursorPixelPos({x:0,y:c}).y*p.DEVICE_PIXEL_RATIO;let e=d;"right"!=this.textAlign&&"end"!=this.textAlign||(e-=r),this.m_context.fillRect(e,t-_,m,a+2*_)}}}{this.m_context.textBaseline="middle";const n=this.width*p.DEVICE_PIXEL_RATIO,o=this.m_height*p.DEVICE_PIXEL_RATIO,l=this.m_leftMargin*p.DEVICE_PIXEL_RATIO,r=this.m_rightMargin*p.DEVICE_PIXEL_RATIO;var c;p.DEVICE_PIXEL_RATIO,c="bottom"==this.m_context.textBaseline||"alphabetic"==this.m_context.textBaseline?0:"middle"==this.m_context.textBaseline?this.m_multiLine?a/2:o/2:0,this.m_context.textAlign="left",this.m_context.fillStyle=this.style.active.highlightedText;const m=this.style.fontSize*p.DEVICE_PIXEL_RATIO;c+=a*e;for(let o=e;o<=s;++o){const _=this.m_lines.at(o);let d=0,u=_;if(o==e)u=e==s?_.substring(t,i):_.substring(t),d=h;else{o==s&&(u=_.substring(0,i));let t=0;"left"!=this.textAlign&&(t=this.getMetrics(_).width*p.DEVICE_PIXEL_RATIO),d="right"==this.textAlign||"end"==this.textAlign?n-r-t:"center"==this.textAlign?n/2-t/2:l}this.m_context.font=m+"px "+this.style.fontName,this.m_context.fillText(u,d,c),c+=a}}}drawCursor(){if(this.hasFocus&&!this.m_readOnly){const t=this.textHeight()*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;if(this.m_showCursor){this.m_context.fillStyle=this.enabled?this.style.active.text:this.style.disabled.text;const i=this.m_cursorPixelPos.x*p.DEVICE_PIXEL_RATIO;let s=this.m_cursorPixelPos.y*p.DEVICE_PIXEL_RATIO;this.m_multiLine||(s=e/2-t/2);const h=1.5*p.DEVICE_PIXEL_RATIO;this.m_context.fillRect(Math.trunc(i),s,h,t)}}}drawCursorLineRect(){if(this.m_multiLine&&!this.m_readOnly){const t=this.textHeight()*p.DEVICE_PIXEL_RATIO,e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_cursorPixelPos.y*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.style.active.button,this.m_context.fillRect(0,i,e,t)}}draw(){this.m_visible&&(this.applyTransformToContext(),this.clipStart(),this.drawFrame(),this.drawCursorLineRect(),this.drawText(),this.drawSelection(),this.drawCursor(),this.clipEnd())}}class U extends D{constructor(e){super(e),this.m_textEditor=new z,this.m_textEditor.objectName="XTextEdit2",this.m_textEditor.addEventListener("cursorPosChanged",this),this.m_textEditor.addEventListener("textAreaChanged",this),this.m_textEditor.addEventListener("textChanged",this),this.m_oldCursorPixelPos=new t,this.m_scrollAnimate=!1,this.m_scrollTimer=0,this.m_scrollStartY=0,this.m_scrollEndY=0,this.scrollWidget=this.m_textEditor}get recommendedWidth(){return 80*this.getMetrics("W").width}get recommendedHeight(){const t=this.getMetrics("W");return 20*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}set text(t){this.m_textEditor.text=t}get text(){return this.m_textEditor.text}append(t){this.m_textEditor.append(t)}set readOnly(t){this.m_textEditor.readOnly=t}get readOnly(){return this.m_textEditor.readOnly}set enabled(t){super.enabled=t,this.m_textEditor.enabled=t}get enabled(){return super.enabled}set textAlign(t){this.m_textEditor.textAlign=t}get textAlign(){return this.m_textEditor.textAlign}update(t){this.m_dirty,super.update(t)}wheelEvent(t){this.scrollY+=t.deltaY,t.accept()}customEvent(t,e,i){switch(super.customEvent(t,e,i),e){case"textChanged":this.onTextChanged(t);break;case"textAreaChanged":this.onTextAreaChanged(t,i.oldWidth,i.oldHeight);break;case"cursorPosChanged":this.onCursorPosChanged(t)}}onTextChanged(t){const e=t.m_cursorPixelPos.x<this.m_oldCursorPixelPos.x?1:0,i=t.m_cursorPixelPos.x>this.m_oldCursorPixelPos.x?2:0,s=t.m_cursorPixelPos.y<this.m_oldCursorPixelPos.y?4:0,h=t.m_cursorPixelPos.y>this.m_oldCursorPixelPos.y?8:0,n=e|i|s|h,o=t.textHeight(),l=t.toGlobalPoint(t.m_cursorPixelPos.x+(n&i?5:0),t.m_cursorPixelPos.y+(n&h?o:0));this.m_contentsWidget.boundary.containsPoint(l)||(this.scrollY=t.m_cursorPixelPos.y-this.m_contentsWidget.height/2)}onTextAreaChanged(t,e,i){const s=t.textHeight(),h=t.toGlobalPoint(t.m_cursorPixelPos.x+5,t.m_cursorPixelPos.y+s);t.height>i?h.y>=this.m_contentsWidget.boundary.max.y&&(this.scrollY+=s):t.height<i&&h.y-s<=this.m_contentsWidget.boundary.min.y&&(this.scrollY-=s),t.width>e?h.x>=this.m_contentsWidget.boundary.max.x&&(this.scrollX+=7):t.width<e&&(this.scrollX-=5)}onCursorPosChanged(t){if(0==t.m_cursorPixelPos.x&&0==t.m_cursorPixelPos.y)return this.scrollX=0,this.scrollY=0,this.m_oldCursorPixelPos.x=t.m_cursorPixelPos.x,void(this.m_oldCursorPixelPos.y=t.m_cursorPixelPos.y);const e=t.m_cursorPixelPos.x<this.m_oldCursorPixelPos.x?1:0,i=t.m_cursorPixelPos.x>this.m_oldCursorPixelPos.x?2:0,s=t.m_cursorPixelPos.y<this.m_oldCursorPixelPos.y?4:0,h=t.m_cursorPixelPos.y>this.m_oldCursorPixelPos.y?8:0,n=e|i|s|h,o=t.textHeight(),l=t.toGlobalPoint(t.m_cursorPixelPos.x+(n&i?5:-5),t.m_cursorPixelPos.y+(n&h?o/2:-o/2)),r=this.m_contentsWidget.boundary.containsPoint(l);this.m_scrollStartY=this.scrollY,n&i?r||t.m_cursorPixelPos.x+5>=this.m_contentsWidget.width+Math.abs(this.m_scrollWidget.x)&&(console.log("GOING RIGHT"),this.scrollX=t.m_cursorPixelPos.x-this.m_contentsWidget.width+7):n&e&&(r||this.scrollX>t.m_cursorPixelPos.x&&(console.log("GOING LEFT"),this.scrollX=t.m_cursorPixelPos.x)),n&h?r||t.m_cursorPixelPos.y+o>=this.m_contentsWidget.height+Math.abs(this.m_scrollWidget.y)&&(console.log("GOING DOWN"),this.scrollY=t.m_cursorPixelPos.y-this.m_contentsWidget.height+o):n&s&&(r||this.scrollY>t.m_cursorPixelPos.y&&(console.log("GOING UP"),this.scrollY=t.m_cursorPixelPos.y)),t.m_selectionMode||(this.m_oldCursorPixelPos.x=t.m_cursorPixelPos.x,this.m_oldCursorPixelPos.y=t.m_cursorPixelPos.y)}}class Y extends D{constructor(t){super(t),this.m_textEditor=new z,this.m_textEditor.objectName="XTextEdit2",this.m_textEditor.eventListener=this,this.m_textEditor.m_multiLine=!1,this.m_textEditor.addEventListener("cursorPosChanged",this),this.m_textEditor.addEventListener("textAreaChanged",this),this.m_textEditor.addEventListener("enterPressed",this),this.m_textEditor.addEventListener("textChanged",this.onTextChanged.bind(this)),this.m_textEditor.addEventListener("keyDown",this),this.scrollWidget=this.m_textEditor,this.verticalScrollBarPolicy=1,this.horizontalScrollBarPolicy=1,this.m_oldCursorPosX=0,this.viewportMargin=3}get recommendedWidth(){const t=this.getMetrics("W");return null!=t?20*t.width:0}get recommendedHeight(){const t=this.getMetrics("W");return null!=t?3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent):0}customEvent(t,e,i){switch(super.customEvent(t,e,i),e){case"enterPressed":this.m_textEditor.clearFocus(),this.m_canvas.focus();break;case"textAreaChanged":this.onTextAreaChanged(t,i.oldWidth,i.oldHeight);break;case"cursorPosChanged":this.onCursorPosChanged(t);break;default:this.invokeEvent(e,i)}}set text(t){this.m_textEditor.text=t.replace("\n"," ")}get text(){return this.m_textEditor.text}set readOnly(t){this.m_textEditor.readOnly=t}get readOnly(){return this.m_textEditor.readOnly}set enabled(t){super.enabled=t,this.m_textEditor.enabled=t}get enabled(){return super.enabled}set textAlign(t){this.m_textEditor.textAlign=t}get textAlign(){return this.m_textEditor.textAlign}set prefix(t){this.m_textEditor.prefix=t}get prefix(){return this.m_textEditor.prefix}set suffix(t){this.m_textEditor.suffix=t}get suffix(){return this.m_textEditor.suffix}setFocus(){this.m_textEditor.setFocus()}selectAll(){this.m_textEditor.selectAll()}update(t){this.m_dirty,super.update(t)}onTextChanged(t){this.invokeEvent("textChanged")}onTextAreaChanged(t,e,i){t.textHeight();const s=t.toGlobalPoint(this.m_oldCursorPosX+5,0);t.width>e?s.x>=this.m_contentsWidget.boundary.max.x&&(this.scrollX+=7):t.width<e&&(this.scrollX-=5)}onCursorPosChanged(t){if(0==t.m_cursorPos.x)return this.scrollX=0,void(this.m_oldCursorPosX=t.m_cursorPixelPos.x);if(t.m_cursorPos.x==t.text.length){let e=0;return t.suffix.length>0&&(e=t.getMetrics(t.suffix).width),this.scrollX=t.m_cursorPixelPos.x+e,void(this.m_oldCursorPosX=t.m_cursorPixelPos.x)}const e=t.m_cursorPixelPos.x<this.m_oldCursorPosX?1:0,i=t.m_cursorPixelPos.x>this.m_oldCursorPosX?2:0,s=e|i,h=(t.textHeight(),t.toGlobalPoint(t.m_cursorPixelPos.x+(s&i?5:0),0)),n=this.m_contentsWidget.boundary.containsPoint(h);s&i?n||(t.m_cursorPixelPos.x+5>=this.m_contentsWidget.width+Math.abs(this.m_scrollWidget.x)?this.scrollX=t.m_cursorPixelPos.x-this.m_contentsWidget.width+7:this.scrollX=t.m_cursorPixelPos.x):s&e&&(n||(this.scrollX,t.m_cursorPixelPos.x,this.scrollX=t.m_cursorPixelPos.x)),t.m_selectionMode||(this.m_oldCursorPosX=t.m_cursorPixelPos.x)}}class F{constructor(t){this.m_columnTexts=new Array(Math.max(1,t)),this.m_data=[],this.m_tableView=null,this.m_columnHeader=null,this.m_verticalHeader=null,this.m_rowHeight=30,this.m_columnWidths=new Array(Math.max(1,t));for(let t=0;t<this.m_columnWidths.length;++t)this.m_columnWidths[t]=180}rowCount(){return this.m_data.length}columnCount(){return this.m_columnTexts.length}columnWidth(t){return t>=0&&t<this.m_columnWidths.length?this.m_columnWidths[t]:0}setColumnWidth(t,e){t>=0&&t<this.m_columnWidths.length&&(this.m_columnWidths[t]=e,this.updateItems())}columnHeaderText(t){return t>=0&&t<this.m_columnTexts.length?this.m_columnTexts[t]:null}setColumnHeaderText(t,e){t>=0&&t<this.m_columnTexts.length&&(this.m_columnTexts[t]=e,this.updateItems())}set rowHeight(t){this.m_rowHeight=t,this.updateItems()}get rowHeight(){return this.m_rowHeight}rowHeaderText(t){return t+1+""}addRow(t){t instanceof Array&&t.length==this.m_columnTexts.length&&(this.m_data.push(t),this.updateItems())}removeRow(t){t>=0&&t<this.m_data.length&&(this.m_data.splice(t,1),this.updateItems())}removeAll(){this.m_data=[],this.updateItems()}data(t,e){if(t>=0&&t<this.m_data.length){let i=this.m_data[t];if(e>=0&&e<i.length)return i[e]}return null}setData(t,e,i){if(t>=0&&t<this.m_data.length){let s=this.m_data[t];e>=0&&e<s.length&&(s[e]=i,this.updateItems())}}updateItems(){null!=this.m_tableView&&(this.m_tableView.m_updateItems=!0),null!=this.m_columnHeader&&(this.m_columnHeader.m_updateItems=!0),null!=this.m_verticalHeader&&(this.m_verticalHeader.m_updateItems=!0)}}class q extends p{constructor(t){super(t),this.m_view=null}parentResizeEvent(){this.m_view.updateItems()}}class j extends S{constructor(t){super("",t),this.m_tableView=null,this.m_row=-1,this.m_column=-1,this.m_hover=!1}set data(t){this.text=t}mouseEnterEvent(){this.m_hover=!0}mouseLeaveEvent(){this.m_hover=!1}draw(){this.applyTransformToContext(),this.clipStart();const t=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=t+"px "+this.style.fontName;const e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_height*p.DEVICE_PIXEL_RATIO,s=.5*p.DEVICE_PIXEL_RATIO,h=p.DEVICE_PIXEL_RATIO;this.m_context.lineWidth=1,this.m_context.fillStyle=this.style.active.widget,this.m_context.fillRect(0,0,e,i);const n=this.m_tableView.viewportMargin*p.DEVICE_PIXEL_RATIO;this.m_column<this.m_tableView.columnCount-1&&(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=h,this.m_context.beginPath(),this.m_context.moveTo(e-n+s,0),this.m_context.lineTo(e-n+s,i),this.m_context.stroke()),this.m_row<this.m_tableView.rowCount-1&&(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=h,this.m_context.beginPath(),this.m_context.moveTo(0,i-n+s),this.m_context.lineTo(e,i-n+s),this.m_context.stroke()),this.m_context.fillStyle=this.style.active.text,this.m_textRenderer.drawText(this.m_context,0,0,e,i,this.alignment),this.clipEnd()}}class Q extends S{constructor(t){super("",t),this.m_tableHeader=null,this.m_index=0,this.m_hover=!1,this.alignment=36}set data(t){this.text=t}mouseDownEvent(t){t.accept()}mouseEnterEvent(){this.m_hover=!0}mouseLeaveEvent(){this.m_hover=!1}draw(){this.applyTransformToContext(),this.clipStart(),this.m_context.fillStyle=this.style.active.text;const t=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=t+"px "+this.style.fontName;const e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_height*p.DEVICE_PIXEL_RATIO,s=.5*p.DEVICE_PIXEL_RATIO,o=p.DEVICE_PIXEL_RATIO;this.m_context.lineWidth=o,this.m_context.fillStyle=this.style.active.widget,this.m_context.fillRect(0,0,e,i);const l=this.m_tableHeader.viewportMargin*p.DEVICE_PIXEL_RATIO;this.m_index<this.m_tableHeader.itemCount-1&&this.m_tableHeader.m_orientation==n&&(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=o,this.m_context.beginPath(),this.m_context.moveTo(e-l+s,0),this.m_context.lineTo(e-l+s,i),this.m_context.stroke()),this.m_index<this.m_tableHeader.itemCount-1&&this.m_tableHeader.m_orientation==h&&(this.m_context.strokeStyle=this.style.active.frame,this.m_context.lineWidth=o,this.m_context.beginPath(),this.m_context.moveTo(0,i-l+s),this.m_context.lineTo(e,i-l+s),this.m_context.stroke()),this.m_context.fillStyle=this.style.active.text,this.m_textRenderer.drawText(this.m_context,0,0,e,i,this.alignment),this.clipEnd()}}class K extends D{constructor(t=n,e=null){super(e),this.scrollWidget=new q,this.m_scrollWidget.objectName="XTableHeaderWidget",this.m_scrollWidget.m_view=this,this.m_orientation=t,this.m_updateItems=!1,this.m_model=null,this.m_itemCached=[],this.m_currentVisibleItem=0,this.viewportMargin=1,this.m_visibleItems=[]}get itemCount(){return this.m_orientation==n?this.m_model.columnCount():this.m_model.rowCount()}update(t){super.update(t),this.m_updateItems&&(this.updateItems(),this.m_updateItems=!1)}onWidgetScroll(){this.m_updateItems=!0}set scrollX(t){super.scrollX=t,this.m_updateItems=!0}set scrollY(t){super.scrollY=t,this.m_updateItems=!0}updateItems(){if(null!=this.m_model){for(let t of this.m_visibleItems)t.visible=!1;if(this.m_visibleItems=[],this.m_orientation==n){let t=0;for(let e=0;e<this.m_model.columnCount();++e)t+=this.m_model.columnWidth(e);this.m_scrollWidget.height=this.height,Math.abs(this.m_scrollWidget.x),this.m_currentVisibleItem=0;const e=this.m_model.columnCount();let i=0;const s=this.m_currentVisibleItem+e;for(let e=this.m_currentVisibleItem;e<=s&&e<this.m_model.columnCount();++e){let s=this.getFreeItem(e);s.m_index=e,s.data=this.m_model.columnHeaderText(e),s.height=this.height,e==this.m_model.columnCount()-1?s.width=this.m_model.columnWidth(e)+this.m_scrollWidget.width-t:s.width=this.m_model.columnWidth(e),s.x=i,s.visible=!0,i+=this.m_model.columnWidth(e),this.m_visibleItems.push(s)}}else if(this.m_orientation==h){const t=this.m_model.rowHeight;this.m_scrollWidget.width=this.width;const e=Math.abs(this.m_scrollWidget.y);this.m_currentVisibleItem=Math.trunc(e/t),this.m_model.rowCount()>0&&-1==this.m_currentVisibleItem&&(this.m_currentVisibleItem=0);const i=this.m_scrollWidget.m_parent.height/t+1,s=this.m_currentVisibleItem+i;let h=this.m_currentVisibleItem*t;for(let e=this.m_currentVisibleItem;e<=s&&e<this.m_model.rowCount();++e){let i=this.getFreeItem(e);i.m_index=e,i.data=this.m_model.rowHeaderText(e),e==this.m_model.rowCount()-1?i.height=t+this.m_scrollWidget.height-this.m_model.rowCount()*t:i.height=t,i.width=this.width,i.y=h,i.visible=!0,h+=t,this.m_visibleItems.push(i)}}}}getFreeItem(t){const e=this.m_orientation==h?this.m_scrollWidget.m_parent.height/this.m_model.rowHeight+3:this.m_model.columnCount();if(this.m_itemCached.length<e){let t=this.createItem(this.m_scrollWidget);return t.focusable=this.focusable,t.m_tableHeader=this,this.m_itemCached.push(t),t}return t>this.m_itemCached.length-1&&(t%=this.m_itemCached.length),this.m_itemCached[t]}createItem(t){return new Q(t)}set model(t){this.m_model=t,this.m_model.m_columnHeader=this,this.m_updateItems=!0}get model(){return this.m_model}}class J extends D{constructor(t){super(t),this.scrollWidget=new q,this.m_scrollWidget.objectName="TableViewScrollWidget",this.m_scrollWidget.m_view=this,this.m_model=null,this.m_itemCached=[],this.m_columnWidths=[],this.m_currentTopItem=-1,this.m_currentLeftItem=-1,this.m_updateItems=!1,this.m_animate=!1,this.m_scrollTimer=0,this.m_startScroll=0,this.m_endScroll=0,this.m_visibleItems=[]}get columnCount(){return null!=this.m_model?this.m_model.columnCount():0}get rowCount(){return null!=this.m_model?this.m_model.rowCount():0}scrollTo(t,e){}update(t){this.m_animate&&(this.m_scrollTimer+=t,this.scrollY=Math.trunc(l.lerp(this.m_startScroll,this.m_endScroll,this.m_scrollTimer/300,l.inOutQuad)),this.m_updateItems=!0,this.m_scrollTimer>=300&&(this.m_animate=!1,this.m_scrollTimer=0)),super.update(t),this.m_updateItems&&(this.updateItems(),this.m_updateItems=!1)}wheelEvent(t){this.m_animate||(this.m_animate=!0,this.m_startScroll=this.scrollY,this.m_endScroll=this.scrollY+t.deltaY),t.accept()}onWidgetScroll(){this.m_updateItems=!0}updateItems(){if(null==this.m_model)return;for(let t of this.m_visibleItems)t.visible=!1;this.m_visibleItems=[];let t=0;for(let e=0;e<this.m_model.columnCount();++e)t+=this.m_model.columnWidth(e);const e=this.m_model.rowHeight,i=t,s=this.m_model.rowCount()*e;this.m_scrollWidget.width=i,this.m_scrollWidget.height=s;const h=Math.abs(this.m_scrollWidget.y);this.m_currentTopItem=Math.trunc(h/e),Math.abs(this.m_scrollWidget.x),this.m_currentLeftItem=0,this.m_model.rowCount()>0&&-1==this.m_currentTopItem&&(this.m_currentTopItem=0);const n=this.m_scrollWidget.m_parent.height/e+1,o=this.m_model.columnCount();let l=this.m_currentTopItem*e,r=0;const m=this.m_currentTopItem+n,a=this.m_currentLeftItem+o;for(let t=this.m_currentTopItem;t<=m&&t<this.m_model.rowCount();++t){for(let i=this.m_currentLeftItem;i<=a&&i<this.m_model.columnCount();++i){let s=this.getFreeItem(t,i);s.m_row=t,s.m_column=i,s.data=this.m_model.data(t,i),s.height=e,s.width=this.m_model.columnWidth(i),s.x=r,s.y=l,s.visible=!0,this.m_visibleItems.push(s),r+=this.m_model.columnWidth(i)}r=0,l+=e}}getFreeItem(t,e){const i=this.m_model.rowHeight,s=(this.m_scrollWidget.m_parent.height/i+3)*this.m_model.columnCount();if(this.m_itemCached.length<s){let t=this.createItem(this.m_scrollWidget);return this.m_itemCached.push(t),t}{let i=t*this.m_model.columnCount()+e;return i>this.m_itemCached.length-1&&(i%=this.m_itemCached.length),this.m_itemCached[i]}}createItem(t){let e=new j(t);return e.focusable=this.focusable,e.m_tableView=this,e}set model(t){this.m_model=t,this.m_model.m_tableView=this,this.m_updateItems=!0}get model(){return this.m_model}}class Z extends p{constructor(t){super(t),this.m_table=new J(this),this.m_table.addEventListener("maxScrollValueChanged",this),this.m_table.addEventListener("verticalScrollChanged",this),this.m_table.addEventListener("horizontalScrollChanged",this),this.m_table.viewportMargin=1,this.m_columnHeader=new K(n,this),this.m_columnHeader.verticalScrollBarPolicy=1,this.m_columnHeader.horizontalScrollBarPolicy=1,this.m_verticalHeader=new K(h,this),this.m_verticalHeader.verticalScrollBarPolicy=1,this.m_verticalHeader.horizontalScrollBarPolicy=1,this.m_upperLeft=new P(this),this.m_upperRight=new P(this),this.m_lowerLeft=new P(this)}get recommendedWidth(){return 300}get recommendedHeight(){return 300}customEvent(t,e,i){"maxScrollValueChanged"==e?(this.m_columnHeader.m_scrollWidget.width=this.m_table.m_scrollWidget.width+this.m_table.viewportMargin,this.m_verticalHeader.m_scrollWidget.height=this.m_table.m_scrollWidget.height+this.m_table.viewportMargin):"verticalScrollChanged"==e?this.m_verticalHeader.scrollY=this.m_table.scrollY:"horizontalScrollChanged"==e&&(this.m_columnHeader.scrollX=this.m_table.scrollX)}update(t){if(this.m_dirty){let t=this.m_height,e=0;this.m_columnHeader.visible&&(t-=this.m_columnHeader.height,e=this.m_columnHeader.height);let i=this.m_width,s=0;this.m_verticalHeader.visible&&(i-=this.m_verticalHeader.width,s=this.m_verticalHeader.width),this.m_table.x=s,this.m_table.y=e,this.m_table.height=t,this.m_table.width=i;const h=this.m_table.m_scrollBarThickness+this.m_table.viewportMargin;this.m_verticalHeader.height=t-h,this.m_verticalHeader.width=50,this.m_verticalHeader.y=e,this.m_columnHeader.width=i-h,this.m_columnHeader.height=30,this.m_columnHeader.x=s,this.m_upperLeft.width=50,this.m_upperLeft.height=30,this.m_upperRight.x=this.width-h,this.m_upperRight.y=0,this.m_upperRight.width=h,this.m_upperRight.height=30,this.m_lowerLeft.height=h,this.m_lowerLeft.width=50,this.m_lowerLeft.y=this.m_verticalHeader.y+this.m_verticalHeader.height}super.update(t)}set model(t){this.m_table.model=t,this.m_columnHeader.model=t,this.m_verticalHeader.model=t}}class ${constructor(){this.m_data=[],this.m_listView=null}rowCount(){return this.m_data.length}add(t){this.m_data.push(t),this.m_listView&&(this.m_listView.m_updateItems=!0)}remove(t){t>=0&&t<this.m_data.length&&(this.m_data.splice(t,1),this.m_listView&&(this.m_listView.m_updateItems=!0))}removeAll(){this.m_data=[],this.m_listView&&(this.m_listView.m_updateItems=!0)}data(t){return t>=0&&t<this.m_data.length?this.m_data[t]:null}setData(t,e){t>=0&&t<this.m_data.length&&(this.m_data[t]=e,this.m_listView&&(this.m_listView.m_updateItems=!0))}indexOf(t){return this.m_data.indexOf(t)}}class tt extends S{constructor(e){super("",e),this.m_listView=null,this.m_free=!1,this.m_index=-1,this.m_hover=!1,this.m_clickTimer=new M,this.m_clickTimer.interval=100,this.m_clickTimer.action=this.clickTimerAction.bind(this),this.m_clickPos=new t}set data(t){this.text=t}get data(){return this.text}clickTimerAction(t){this.isWithinGlobalRect(this.m_clickPos)&&(this.m_listView.currentIndex=this.m_index,this.m_listView.invokeEvent("currentIndexChanged")),this.m_clickTimer.stop()}mouseDownEvent(e){this.m_clickPos=new t(e.globalPos.x,e.globalPos.y),this.m_clickTimer.start()}mouseUpEvent(t){}mouseMoveEvent(t){this.m_clickTimer.stop()}mouseEnterEvent(){this.m_hover=!0}mouseLeaveEvent(){this.m_hover=!1}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=p.DEVICE_PIXEL_RATIO;this.m_context.lineWidth=i;let s=this.style.active.widget;this.m_index==this.m_listView.currentIndex?s=this.style.active.highlighted:this.m_hover&&(s=this.style.active.buttonHover),this.m_context.fillStyle=s,this.m_context.fillRect(0,0,t,e),this.m_index==this.m_listView.currentIndex?this.m_context.fillStyle=this.style.active.highlightedText:this.m_context.fillStyle=this.style.active.text;const h=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=h+"px "+this.style.fontName,this.m_textRenderer.drawText(this.m_context,5*i,0,t,e,this.alignment),this.clipEnd()}}class et extends p{constructor(t){super(t),this.m_view=null,this.focusable=!1}parentResizeEvent(){this.m_view.updateItems()}}class it extends D{constructor(t){super(t),this.scrollWidget=new et,this.m_scrollWidget.objectName="XListViewScrollWidget",this.m_scrollWidget.m_view=this,this.m_model=null,this.m_itemCached=[],this.m_itemHeight=30,this.m_currentTopItem=-1,this.m_updateItems=!1,this.m_currentIndex=-1,this.m_animate=!1,this.m_scrollTimer=0,this.m_startScroll=0,this.m_endScroll=0,this.m_visibleItems=[],this.viewportMargin=1,this.m_shadowEnabled=!1}parentChangeEvent(){if(null!=this.m_context){const t=this.getMetrics("W"),e=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;this.m_itemHeight=3*e}}get recommendedWidth(){return 200}get recommendedHeight(){return 6*this.m_itemHeight}set shadowEnabled(t){this.m_shadowEnabled=t}get shadowEnabled(){return this.m_shadowEnabled}scrollToIndex(t){let e=this.m_itemHeight*t;this.scrollY=e,this.m_updateItems=!0}set currentIndex(t){this.m_currentIndex=t,this.m_updateItems=!0}get currentIndex(){return this.m_currentIndex}update(t){this.m_animate&&(this.m_scrollTimer+=t,this.scrollY=Math.trunc(l.lerp(this.m_startScroll,this.m_endScroll,this.m_scrollTimer/300,l.inOutQuad)),this.m_updateItems=!0,this.m_scrollTimer>=300&&(this.m_animate=!1,this.m_scrollTimer=0)),super.update(t),this.m_updateItems&&(this.updateItems(),this.m_updateItems=!1)}wheelEvent(t){this.m_animate||(this.m_animate=!0,this.m_startScroll=this.scrollY,this.m_endScroll=this.scrollY+t.deltaY),t.accept()}onWidgetScroll(){this.m_updateItems=!0}updateItems(){if(null==this.m_model)return;for(let t of this.m_visibleItems)t.visible=!1;this.m_visibleItems=[],this.m_model.rowCount()>0?-1==this.m_currentIndex&&(this.m_currentIndex=0):this.m_currentIndex=-1;const t=this.m_scrollWidget.m_parent.m_width,e=this.m_model.rowCount()*this.m_itemHeight;this.m_scrollWidget.width=t,this.m_scrollWidget.height=e;const i=Math.abs(this.m_scrollWidget.y);this.m_currentTopItem=Math.trunc(i/this.m_itemHeight),this.m_model.rowCount()>0&&-1==this.m_currentTopItem&&(this.m_currentTopItem=0);const s=Math.trunc(this.m_scrollWidget.m_parent.height/this.m_itemHeight)+1,h=this.m_currentTopItem+s;let n=this.m_currentTopItem*this.m_itemHeight;for(let t=this.m_currentTopItem;t<=h&&t<this.m_model.rowCount();++t){let e=this.getFreeItem(t);e.m_index=t,e.data=this.m_model.data(t),e.height=this.m_itemHeight,e.width=this.m_scrollWidget.width,e.x=0,e.y=n,e.visible=!0,n+=this.m_itemHeight,this.m_visibleItems.push(e)}}getFreeItem(t){const e=this.m_scrollWidget.m_parent.height/this.m_itemHeight+2;if(this.m_itemCached.length<e){let t=this.createItem(this.m_scrollWidget);return t.focusable=this.focusable,t.m_listView=this,this.m_itemCached.push(t),t}return t>this.m_itemCached.length-1&&(t%=this.m_itemCached.length),this.m_itemCached[t]}createItem(t){return new tt(t)}set model(t){this.m_model=t,this.m_model.m_listView=this,this.m_updateItems=!0}draw(){if(this.applyTransformToContext(),this.m_shadowEnabled){const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.save(),this.m_context.shadowColor="rgb(100,100,100)",this.m_context.shadowBlur=5*p.DEVICE_PIXEL_RATIO,this.m_context.shadowOffsetX=0,this.m_context.shadowOffsetY=0,this.m_context.fillRect(0,0,t,e),this.m_context.restore()}this.clipStart(),this.drawBackground(this.style.active.widget),this.drawFrame(this.frameColor),this.drawChildren(),this.clipEnd()}}class st extends P{constructor(t){super(t),this.m_model=new $,this.m_listView=new it,this.m_listView.visible=!1,this.m_listView.model=this.m_model,this.m_listView.focusable=!1,this.m_listView.shadowEnabled=!0,this.m_listView.addEventListener("currentIndexChanged",this.onListViewCurrentIndexChanged.bind(this)),this.m_text="",this.m_textRenderer=new f,this.m_closeTimer=new M,this.m_closeTimer.interval=200,this.m_closeTimer.singleShot=!0,this.m_closeTimer.action=this.closeTimerAction.bind(this)}get recommendedWidth(){return 20*this.getMetrics("W").width}get recommendedHeight(){const t=this.getMetrics("W");return 3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}addItem(t){this.m_model.add(t),-1==this.m_listView.currentIndex&&(this.m_text=this.m_model.data(0))}removeItem(t){if(t>=0&&t<this.m_model.rowCount()){let e=0;t==this.currentIndex&&this.currentIndex>0&&(e=this.currentIndex-1),this.m_model.remove(t),this.m_model.rowCount()>0?this.currentIndex=e:this.m_text=""}}set currentIndex(t){t>=0&&t<this.m_model.rowCount()&&(this.m_listView.currentIndex=t,this.m_text=this.m_model.data(t))}get currentIndex(){return this.m_listView.currentIndex}indexOf(t){return this.m_model.indexOf(t)}closeTimerAction(){this.m_listView.visible=!1}onListViewCurrentIndexChanged(t){if(t==this.m_listView){const t=this.m_listView.currentIndex;t>=0&&t<this.m_model.rowCount()&&(this.m_text=this.m_model.data(t),this.m_closeTimer.start())}}parentChangeEvent(){let t=this.m_parent;for(;t instanceof p&&null!=t.m_parent;)t=t.m_parent;t.addChild(this.m_listView)}keyDownEvent(t){if(this.enabled)switch(t.key){case"Enter":case"Escape":this.m_listView.visible=!1;break;case"ArrowUp":this.currentIndex=this.currentIndex-1,this.m_listView.scrollToIndex(this.m_listView.currentIndex);break;case"ArrowDown":this.currentIndex=this.currentIndex+1,this.m_listView.scrollToIndex(this.m_listView.currentIndex)}}focusEnterEvent(){}focusLeaveEvent(){this.m_listView.visible=!1}mouseDownEvent(t){t.accept()}mouseUpEvent(t){if(this.enabled&&this.isWithinGlobalRect(t.globalPos)){this.m_listView.visible=!this.m_listView.visible;let t=this.toGlobalPoint(0,this.height),e=this.m_listView.m_parent.toLocalPoint(t.x,t.y);this.m_listView.visible&&(this.m_listView.scrollToIndex(this.m_listView.currentIndex),this.m_listView.x=e.x,this.m_listView.height+e.y>this.m_listView.m_parent.height?this.m_listView.y=e.y-this.m_listView.height-this.height:this.m_listView.y=e.y,this.m_listView.raise())}}wheelEvent(t){t.deltaY>0?(this.currentIndex=this.currentIndex+1,this.m_listView.scrollToIndex(this.m_listView.currentIndex)):(this.currentIndex=this.currentIndex-1,this.m_listView.scrollToIndex(this.m_listView.currentIndex)),t.accept()}update(t){const e=this.m_dirty;super.update(t),e&&(this.m_listView.width=this.width,this.m_listView.height=5*this.m_listView.m_itemHeight)}draw(){this.applyTransformToContext(),this.clipStart(),this.drawBackground(this.style.active.widget),this.drawFrame(this.frameColor);const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=(p.DEVICE_PIXEL_RATIO,p.DEVICE_PIXEL_RATIO);let s=null;s=this.enabled?this.style.active.text:this.style.disabled.text,this.m_context.fillStyle=s;const h=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=h+"px "+this.style.fontName,this.m_textRenderer.text=this.m_text,this.m_textRenderer.drawText(this.m_context,5*i,0,t,e,33),this.m_context.strokeStyle=this.enabled?this.style.active.highlighted:this.style.disabled.highlighted,this.m_context.lineWidth=2*p.DEVICE_PIXEL_RATIO;const n=3*p.DEVICE_PIXEL_RATIO,o=5*p.DEVICE_PIXEL_RATIO,l=8*p.DEVICE_PIXEL_RATIO;this.m_context.beginPath(),this.m_context.moveTo(t-l,e/2-n),this.m_context.lineTo(t-(l+o),e/2+n),this.m_context.lineTo(t-(l+2*o),e/2-n),this.m_context.stroke(),this.clipEnd()}}class ht extends L{constructor(t){super(t)}get recommendedWidth(){return 150}get recommendedHeight(){const t=this.getMetrics("W");return 3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.style.active.button,this.m_context.fillRect(0,0,t,e);const i=t*(this.value-this.minValue)/(this.maxValue-this.minValue);this.m_context.fillStyle=this.style.active.highlighted,this.m_context.fillRect(0,0,i,e),this.clipEnd()}onValueChanged(){}onMaxValueChanged(){}onMinValueChanged(){}}class nt extends O{constructor(t,e=null){super(e,t),this.thumbSize=10}get recommendedWidth(){return 150}get recommendedHeight(){const t=this.getMetrics("W");return 3*(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)}mouseMoveEvent(t){if(this.enabled&&(this.m_hover=this.m_thumbRect.containsPoint(t.localPos),this.m_scrollOk)){let e=0;const i=this.maxValue-this.minValue;e=this.m_orientation==h?this.m_origValue+(t.localPos.y-this.m_origPos)/this.m_height*i:this.m_origValue+(t.localPos.x-this.m_origPos)/this.m_width*i,this.value=Math.trunc(e),this.m_callReceiver=!0,t.accept()}}wheelEvent(t){this.value+=t.deltaY>0?1:-1,this.m_callReceiver=!0,t.accept()}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=(p.DEVICE_PIXEL_RATIO,10*p.DEVICE_PIXEL_RATIO);this.m_context.fillStyle=this.style.active.button,this.m_orientation==h?this.m_context.fillRect(i,0,t-2*i,e):this.m_context.fillRect(0,i,t,e-2*i);let s=null;s=this.enabled?this.m_scrollOk?this.style.active.buttonOnDown:this.m_hover?this.style.active.buttonOnHover:this.style.active.buttonOn:this.style.disabled.buttonOn,this.m_context.fillStyle=s;const n=this.m_thumbRect.x*p.DEVICE_PIXEL_RATIO,o=this.m_thumbRect.y*p.DEVICE_PIXEL_RATIO,l=this.m_thumbRect.width*p.DEVICE_PIXEL_RATIO,r=this.m_thumbRect.height*p.DEVICE_PIXEL_RATIO;this.m_context.fillRect(n,o,l,r),this.clipEnd()}}class ot extends w{constructor(t){super("",t)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=.5*p.DEVICE_PIXEL_RATIO,s=8*p.DEVICE_PIXEL_RATIO;let h=null;this.m_down?h=this.style.active.buttonDown:this.m_hover&&(h=this.style.active.buttonHover),null!=h&&(this.m_context.fillStyle=h,this.m_context.fillRect(0,0,t,e)),this.m_context.lineWidth=1.5*p.DEVICE_PIXEL_RATIO;let n=this.parent.foregroundColor;null==n&&(n=this.style.active.text),this.m_context.strokeStyle=n,"x"==this.text?(this.m_context.beginPath(),this.m_context.moveTo(s+i,s+i),this.m_context.lineTo(t-s,e-s),this.m_context.stroke(),this.m_context.beginPath(),this.m_context.moveTo(t-s,s+i),this.m_context.lineTo(s+i,e-s),this.m_context.stroke()):"-"==this.text?(this.m_context.beginPath(),this.m_context.moveTo(s+i,e/2+i),this.m_context.lineTo(t-s,e/2+i),this.m_context.stroke()):"+"==this.text&&this.m_context.strokeRect(s+i,s+i,t-2*s,e-2*s),this.clipEnd()}get recommendedWidth(){return this.parent.height-2}}class lt extends p{constructor(e){super(e),this.m_origMouseGlobalPos=new t,this.m_origGlobalPos=new t,this.m_titleText="dialog",this.m_dialog=null,this.m_move=!1,this.close=new ot(this),this.close.text="x",this.close.addEventListener("clicked",this.onCloseClicked.bind(this)),this.minimize=new ot(this),this.minimize.text="-",this.minimize.addEventListener("clicked",this.onMinimizeClicked.bind(this)),this.maximize=new ot(this),this.maximize.text="+",this.maximize.addEventListener("clicked",this.onMaximizeClicked.bind(this)),this.title=new S("dialog"),this.contentsMargins.left=3,this.style.active.widget=this.style.active.button;let s=new A(n,this);s.spacing=2,s.margins=2,s.addWidget(this.title),s.addStretch(),s.addWidget(this.minimize),s.addWidget(this.maximize),s.addWidget(this.close),this.m_animationElapsed=0,this.m_timer=new M,this.m_timer.action=this.animate.bind(this),this.m_startRect=new i,this.m_endRect=new i,this.m_fade=!1,this.m_startAlpha=1,this.m_endAlpha=0,this.m_restoreRect=new i}onCloseClicked(t){this.m_timer.isRunning||(this.m_fade=!0,this.m_startAlpha=1,this.m_endAlpha=0,this.m_timer.start())}onRestoreClicked(t){}onMinimizeClicked(t){if(this.m_timer.isRunning)return;this.m_dialog.layout;let e=0,i=0;e=this.m_dialog.minimumWidth,i=this.m_dialog.minimumHeight,this.m_startRect.x=this.m_dialog.x,this.m_startRect.y=this.y,this.m_startRect.width=this.m_dialog.width,this.m_startRect.height=this.m_dialog.height,this.m_endRect.x=0,null!=this.m_dialog.parent?this.m_endRect.y=this.m_dialog.m_parent.height-i-this.height:this.m_endRect.y=this.m_dialog.canvas.height-i-this.height,this.m_endRect.height=i,this.m_endRect.width=e,this.m_timer.start()}onMaximizeClicked(t){this.m_timer.isRunning||(this.m_restoreWidth=this.m_dialog.width,this.m_restoreHeight=this.m_dialog.height,this.m_startRect.x=this.m_dialog.x,this.m_startRect.y=this.y,this.m_startRect.width=this.m_dialog.width,this.m_startRect.height=this.m_dialog.height,this.m_endRect.x=0,this.m_endRect.y=0,null!=this.m_dialog.parent?(this.m_endRect.height=this.m_dialog.parent.height-this.height,this.m_endRect.width=this.m_dialog.parent.width):(this.m_endRect.height=this.m_dialog.canvas.height-this.height,this.m_endRect.width=this.m_dialog.canvas.width),this.m_dialog.raise(),this.m_timer.start())}mouseDownEvent(t){this.m_move=!0,this.m_origMouseGlobalPos.x=t.globalPos.x,this.m_origMouseGlobalPos.y=t.globalPos.y,this.m_origGlobalPos=this.toGlobalPoint(0,0),this.raise(),this.m_dialog.raise(),t.accept()}mouseMoveEvent(t){this.m_move&&(this.m_dialog.x=this.m_origGlobalPos.x+t.globalPos.x-this.m_origMouseGlobalPos.x,this.m_dialog.y=this.m_origGlobalPos.y+t.globalPos.y-this.m_origMouseGlobalPos.y),t.accept()}mouseUpEvent(t){this.m_dialog.m_alpha=1,this.m_move=!1}animate(t){let e=100;this.m_animationElapsed+=t,this.m_fade?(e=200,this.m_dialog.m_alpha=l.lerp(this.m_startAlpha,this.m_endAlpha,this.m_animationElapsed/e,l.easeOutCirc)):(this.m_dialog.x=l.lerp(this.m_startRect.x,this.m_endRect.x,this.m_animationElapsed/e,l.easeOutCirc),this.m_dialog.y=l.lerp(this.m_startRect.y,this.m_endRect.y,this.m_animationElapsed/e,l.easeOutCirc),this.m_dialog.width=l.lerp(this.m_startRect.width,this.m_endRect.width,this.m_animationElapsed/e,l.easeOutCirc),this.m_dialog.height=l.lerp(this.m_startRect.height,this.m_endRect.height,this.m_animationElapsed/e,l.easeOutCirc)),this.m_animationElapsed>=e&&(this.m_animationElapsed=0,this.m_fade&&(this.m_dialog.visible=!1),this.m_fade=!1,this.m_timer.stop())}draw(){if(!this.m_visible)return;this.applyTransformToContext(),this.clipStart(),this.m_context.globalAlpha=this.m_dialog.m_alpha,this.m_context.fillStyle=this.style.active.widget;const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO;this.m_context.fillRect(0,0,t,e),this.drawChildren(),this.clipEnd()}}class rt extends p{static grabLeft=1;static grabRight=2;static grabBottom=4;constructor(e){super(e),this.m_titleBar=new lt(e),this.m_titleBar.m_dialog=this,this.m_titleBar.addEventListener("shown",this.onTitleBarShown.bind(this)),this.m_titleBar.addEventListener("hidden",this.onTitleBarHidden.bind(this)),this.m_origMouseGlobalPos=new t,this.m_origTopLeft=new t,this.m_origBottomRight=new t,this.m_origWidth=0,this.m_origHeight=0,this.m_titleHeight=30,this.m_resizable=!1,this.m_grabFlag=0,this.m_lockGrab=!1,this.m_titleBarVisible=!0,this.m_alpha=1,this.m_cursor="default"}onTitleBarShown(t){this.y=this.m_titleBar.y}onTitleBarHidden(t){this.y=this.m_titleBar.y}set titleBarVisible(t){this.m_titleBarVisible=t,this.m_titleBar.visible=t}get titleBarVisible(){return this.m_titleBarVisible}set title(t){this.m_titleBar.m_titleText=t}get title(){return this.m_titleBar.m_titleText}set titleBarBackgroundColor(t){this.m_titleBar.backgroundColor=t}set titleBarForegroundColor(t){this.m_titleBar.foregroundColor=t}set y(t){this.m_titleBar.y=t,this.m_titleBar.visible?super.y=this.m_titleBar.y+this.m_titleBar.height:super.y=t}set x(t){this.m_titleBar.x=t,super.x=this.m_titleBar.x}get x(){return super.x}get y(){return super.y}set resizable(t){this.m_resizable=t}get resizable(){return this.m_resizable}showEvent(){this.m_titleBarVisible&&(this.m_titleBar.visible=!0),this.m_alpha=1,this.raise()}hideEvent(){this.m_titleBarVisible&&(this.m_titleBar.visible=!1)}raise(){super.raise(),this.m_titleBar.raise()}parentChangeEvent(){this.parent.addChild(this.m_titleBar)}mouseDownEvent(t){if(this.m_resizable){this.m_lockGrab=!0,t.accept();const e=t.globalPos.x,i=t.globalPos.y;this.m_origTopLeft=this.toGlobalPoint(0,0),this.m_origBottomRight=this.toGlobalPoint(this.width,this.height),this.m_origMouseGlobalPos.x=e,this.m_origMouseGlobalPos.y=i,this.m_origWidth=this.width,this.m_origHeight=this.height,this.m_grabFlag=0,Math.abs(e-this.m_origTopLeft.x)<5&&(this.m_grabFlag|=rt.grabLeft),Math.abs(e-this.m_origBottomRight.x)<5&&(this.m_grabFlag|=rt.grabRight),Math.abs(i-this.m_origBottomRight.y)<5&&(this.m_grabFlag|=rt.grabBottom)}}mouseMoveEvent(e){const i=e.globalPos.x,s=e.globalPos.y;if(this.m_resizable&&!this.m_lockGrab&&(this.m_origTopLeft=this.toGlobalPoint(0,0),this.m_origBottomRight=this.toGlobalPoint(this.width,this.height),this.m_origMouseGlobalPos.x=i,this.m_origMouseGlobalPos.y=s,this.m_origWidth=this.width,this.m_origHeight=this.height,this.m_grabFlag=0,Math.abs(i-this.m_origTopLeft.x)<5&&(this.m_grabFlag|=rt.grabLeft),Math.abs(i-this.m_origBottomRight.x)<5&&(this.m_grabFlag|=rt.grabRight),Math.abs(s-this.m_origBottomRight.y)<5&&(this.m_grabFlag|=rt.grabBottom),this.m_grabFlag&rt.grabRight&&this.m_grabFlag&rt.grabBottom?this.m_cursor="se-resize":this.m_grabFlag&rt.grabLeft&&this.m_grabFlag&rt.grabBottom?this.m_cursor="sw-resize":this.m_grabFlag&rt.grabLeft?this.m_cursor="w-resize":this.m_grabFlag&rt.grabRight?this.m_cursor="e-resize":this.m_grabFlag&rt.grabBottom?this.m_cursor="s-resize":this.m_cursor="default"),this.m_resizable&&this.m_lockGrab){if(this.m_grabFlag&rt.grabLeft){let e=new t;null!=this.parent?e=this.parent.toLocalPoint(this.m_origTopLeft.x+i-this.m_origMouseGlobalPos.x,0):e.x=this.m_origTopLeft.x+i-this.m_origMouseGlobalPos.x;const s=this.m_origBottomRight.x-e.x;s>this.minimumWidth&&(this.x=e.x,this.width=s)}this.m_grabFlag&rt.grabRight&&(this.width=this.m_origWidth+i-this.m_origMouseGlobalPos.x),this.m_grabFlag&rt.grabBottom&&(this.height=this.m_origHeight+s-this.m_origMouseGlobalPos.y)}this.m_canvas.style.cursor=this.m_cursor,e.accept()}mouseEnterEvent(){this.m_lockGrab||(this.m_canvas.style.cursor="default")}mouseLeaveEvent(){this.m_lockGrab||(this.m_canvas.style.cursor="default")}mouseUpEvent(t){this.m_lockGrab=!1}update(t){if(this.m_dirty){const t=this.getMetrics("H"),e=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent;this.m_titleHeight=Math.max(30,3*e),this.m_titleBar.height=this.m_titleHeight,this.m_titleBar.width=this.width}this.m_titleBar.visible&&(this.y=this.m_titleBar.y,this.x=this.m_titleBar.x),super.update(t)}draw(){if(!this.m_visible)return;this.applyTransformToContext();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=this.m_titleBar.visible?this.m_titleHeight*p.DEVICE_PIXEL_RATIO:0;if(this.m_context.save(),this.m_context.globalAlpha=this.m_alpha,this.m_context.fillStyle=this.style.active.widget,this.m_context.shadowColor="rgb(100,100,100)",this.m_context.shadowBlur=5*p.DEVICE_PIXEL_RATIO,this.m_context.shadowOffsetX=0,this.m_context.shadowOffsetY=0,this.m_context.fillRect(0,-i,t,e+i),this.m_context.restore(),this.clipStart(),this.m_lockGrab){this.m_context.fillStyle=this.style.active.highlighted;const i=1*p.DEVICE_PIXEL_RATIO;this.m_grabFlag&rt.grabLeft&&this.m_context.fillRect(0,0,i,e),this.m_grabFlag&rt.grabRight&&this.m_context.fillRect(t-i,0,i,e),this.m_grabFlag&rt.grabBottom&&this.m_context.fillRect(0,e-i,t,i)}this.m_context.globalAlpha=this.m_alpha,this.drawChildren(),this.clipEnd()}}class mt{constructor(t="",e=null){this.m_parent=null,this.m_children=[],this.m_expanded=!1,this.m_data=t,this.m_treeView=null,this.m_level=0,e instanceof mt&&e.addChild(this)}setData(t,e){this.m_data=e}data(t){return this.m_data}get level(){return this.m_level}addChild(t){t instanceof mt&&(null!=t.parent&&t.parent.removeChild(t),t.m_level=this.m_level+1,t.m_parent=this,this.m_children.push(t))}removeChild(t){if(t instanceof mt&&t.m_parent==this){const e=this.m_children.indexOf(t);this.m_children.splice(e,1),t.m_parent=null}}removeChildByIndex(t){t>=0&&t<this.m_children.length&&this.removeChild(this.m_children[t])}get parent(){return this.m_parent}get children(){return this.m_children}set expanded(t){this.m_expanded=t}get expanded(){return this.m_expanded}get expandedIncludingAncestors(){let t=this.m_expanded;return null!=this.m_parent&&(t&&=this.m_parent.expanded),t}getTreeCount(t=!0){let e=1;if(t||!t&&this.m_expanded)for(let i of this.m_children)e+=i.getTreeCount(t);return e}get hasChildren(){return this.m_children.length>0}print(t=0){let e="";for(let i=0;i<t;++i)e+=" ";console.log(e+this.m_data),t++;for(let e of this.m_children)e.print(t)}findItem(t,e=!0){if(0==t)return this;if(t--,e||!e&&this.m_expanded)for(let i of this.m_children){let s=i.findItem(t,e);if(null!=s)return s;e||i.m_expanded?t-=i.getTreeCount(e):t--}return null}}class at{constructor(t=1){this.m_columnTexts=new Array(t),this.m_roots=[],this.m_treeView=null,this.m_columnHeader=null,this.m_rowHeight=30,this.m_defaultColumnWidth=80,this.m_columnWidths=new Map}get fullRowCount(){let t=0;for(let e of this.m_roots)t+=e.getTreeCount(!0);return t}get rowCount(){let t=0;for(let e of this.m_roots)t+=e.getTreeCount(!1);return t}get columnCount(){return this.m_columnTexts.length}columnWidth(t){return this.m_columnWidths.has(t)?this.m_columnWidths.get(t):this.m_defaultColumnWidth}setColumnWidth(t,e){this.m_columnWidths.set(t,e),this.updateItems()}columnHeaderText(t){return t>=0&&t<this.m_columnTexts.length?this.m_columnTexts[t]:""}setColumnHeaderText(t,e){t>=0&&t<this.m_columnTexts.length&&(this.m_columnTexts[t]=e,this.updateItems())}set rowHeight(t){this.m_rowHeight=t,this.updateItems()}get rowHeight(){return this.m_rowHeight}addRootItem(t){t instanceof mt&&null==t.parent&&(t.m_ta,this.m_roots.push(t),this.updateItems())}addItem(t,e){if(t instanceof mt){let i=this.findItem(e);null!=i&&i.addChild(t)}}rowHeaderText(t){return t+1+""}addColumn(t,e=[]){}removeColumn(t){}removeAll(){this.updateItems()}data(t,e){let i=this.findItem(t);if(null!=i)return i.data(e)}setData(t,e,i){let s=this.findItem(t);null!=s&&(s.setData(e,i),this.updateItems())}print(){for(let t of this.m_roots)t.print()}updateItems(){null!=this.m_treeView&&(this.m_treeView.m_updateItems=!0),null!=this.m_columnHeader&&(this.m_columnHeader.m_updateItems=!0)}findItem(t,e=!0){for(let i of this.m_roots)if(e){if(t<i.getTreeCount())return i.findItem(t,!0);t-=i.getTreeCount()}else{let s=i.findItem(t,e);if(null!=s)return s;i.m_expanded?t-=i.getTreeCount(e):t--}return null}}class _t extends v{constructor(t){super("",t)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=.5*p.DEVICE_PIXEL_RATIO;p.DEVICE_PIXEL_RATIO,this.m_context.strokeStyle=this.style.active.frame,this.m_context.strokeRect(i,i,t,e),this.m_context.fillStyle=this.style.active.text;const s=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=s+"px "+this.style.fontName,this.on?this.m_textRenderer.text="-":this.m_textRenderer.text="+",this.m_textRenderer.drawText(this.m_context,0,0,t,e,36),this.clipEnd()}}class dt extends p{constructor(t){super(t),this.m_modelIndex=null,this.m_treeView=null,this.m_row=0,this.m_hover=!1,this.m_leftMargin=0,this.m_expandButtonSize=16,this.m_expandButton=new _t(this),this.m_expandButton.visible=!1,this.m_expandButton.addEventListener("clicked",this.onExpandButtonClicked.bind(this))}onExpandButtonClicked(t){null!=this.m_modelIndex&&(this.m_modelIndex.expanded=t.on,this.m_treeView.updateItems())}set expandButton(t){null!=this.m_expandButton&&this.m_expandButton.removeEventListener("clicked",this.onExpandButtonClicked.bind(this)),this.m_expandButton=t,this.m_expandButton.addEventListener("clicked",this.onExpandButtonClicked.bind(this)),this.m_dirty=!0}get expandedButton(){return this.m_expandButton}set expandButtonSize(t){this.m_expandButtonSize=t,this.m_dirty=!0}get expandButtonSize(){return this.m_expandButtonSize}mouseMoveEvent(t){t.accept()}mouseEnterEvent(){this.m_hover=!0}mouseLeaveEvent(){this.m_hover=!1}set modelIndex(t){this.m_modelIndex=t,this.m_expandButton.on=this.m_modelIndex.expanded,this.m_dirty=!0}get modelIndex(){return this.m_modelIndex}set row(t){this.m_row=t,this.m_dirty=!0}get row(){return this.m_row}set leftMargin(t){this.m_leftMargin=t,this.m_dirty=!0}get leftMargin(){return this.m_leftMargin}update(t){this.m_dirty&&null!=this.m_modelIndex&&(this.m_expandButton.visible=this.m_modelIndex.hasChildren,this.m_expandButton.x=this.m_expandButtonSize/2+this.m_leftMargin,this.m_expandButton.y=this.height/2-this.m_expandButtonSize/2,this.m_expandButton.width=this.m_expandButtonSize,this.m_expandButton.height=this.m_expandButtonSize),super.update(t)}draw(){this.applyTransformToContext(),this.clipStart(),this.m_context.textAlign="left",this.m_context.textBaseline="middle";const t=this.style.fontSize*p.DEVICE_PIXEL_RATIO;this.m_context.font=t+"px "+this.style.fontName;const e=this.m_width*p.DEVICE_PIXEL_RATIO,i=this.m_height*p.DEVICE_PIXEL_RATIO,s=(p.DEVICE_PIXEL_RATIO,p.DEVICE_PIXEL_RATIO),h=(this.m_expandButton.x+this.m_expandButton.width+5)*p.DEVICE_PIXEL_RATIO,n=5*p.DEVICE_PIXEL_RATIO,o=i/2+s;if(this.m_context.fillStyle=this.style.active.widget,this.m_context.fillRect(0,0,e,i),this.m_context.fillStyle=this.style.active.text,null!=this.m_modelIndex){let t=h;null==this.m_modelIndex.parent&&(t=this.m_expandButton.visible?h:0),this.m_context.fillText(this.m_modelIndex.data(0),n+t,o)}this.drawChildren(),this.clipEnd()}}class ct extends p{constructor(t){super(t),this.m_view=null}parentResizeEvent(){this.m_view.updateItems()}}class ut extends D{constructor(t){super(t),this.scrollWidget=new ct,this.scrollWidget.m_view=this,this.m_model=null,this.m_itemCache=[],this.m_currentTopItem=-1,this.m_currentLeftItem=-1,this.m_updateItems=!1,this.m_animate=!1,this.m_scrollTimer=0,this.m_startScroll=0,this.m_endScroll=0,this.m_visibleItems=[]}get recommendedWidth(){return 300}get recommendedHeight(){return 300}get columnCount(){return null!=this.m_model?this.m_model.columnCount:0}get fullRowCount(){return null!=this.m_model?this.m_model.fullRowCount:0}get rowCount(){return null!=this.m_model?this.m_model.rowCount:0}update(t){this.m_animate&&(this.m_scrollTimer+=t,this.scrollY=Math.trunc(l.lerp(this.m_startScroll,this.m_endScroll,this.m_scrollTimer/300,l.inOutQuad)),this.m_updateItems=!0,this.m_scrollTimer>=300&&(this.m_animate=!1,this.m_scrollTimer=0)),(this.m_updateItems||this.dirty)&&(this.updateItems(),this.m_updateItems=!1),super.update(t)}wheelEvent(t){this.m_animate||(this.m_animate=!0,this.m_startScroll=this.scrollY,this.m_endScroll=this.scrollY+t.deltaY),t.accept()}onWidgetScroll(){this.m_updateItems=!0}updateItems(){if(null==this.m_model)return;for(let t of this.m_visibleItems)t.visible=!1;this.m_visibleItems=[],this.width;const t=this.m_model.rowHeight,e=this.m_model.rowCount*t,i=this.m_scrollWidget.m_parent.m_width,s=e;this.m_scrollWidget.width=i,this.m_scrollWidget.height=s;const h=Math.abs(this.m_scrollWidget.y);this.m_currentTopItem=Math.trunc(h/t),Math.abs(this.m_scrollWidget.x),this.m_currentLeftItem=0,this.m_model.rowCount>0&&-1==this.m_currentTopItem&&(this.m_currentTopItem=0);const n=this.m_scrollWidget.m_parent.height/t+1;this.m_model.columnCount;let o=this.m_currentTopItem*t,l=0;this.m_currentTopItem,this.m_currentLeftItem;for(let e=0,i=this.m_currentTopItem;e<n&&i<this.m_model.rowCount;++i){let s=this.m_model.findItem(i,!1);if(null==s)continue;if(null!=s.parent&&!s.parent.expandedIncludingAncestors)continue;let h=this.getFreeItem(e);h.row=i,h.modelIndex=s,h.height=t,h.m_leftMargin=15*h.m_modelIndex.level,h.width=this.m_scrollWidget.width,h.x=0,h.y=i*t,h.visible=!0,this.m_visibleItems.push(h),l=0,o+=t,++e}}getFreeItem(t){const e=this.m_model.rowHeight,i=this.m_scrollWidget.m_parent.height/e+3;if(this.m_itemCache.length<i){let t=this.createItem(this.m_scrollWidget);return t.focusable=this.focusable,t.m_treeView=this,this.m_itemCache.push(t),t}{let e=t;return e>this.m_itemCache.length-1&&(e%=this.m_itemCache.length),this.m_itemCache[e]}}createItem(t){return new dt(t)}set model(t){this.m_model=t,this.m_model.m_treeView=this,this.m_updateItems=!0}get model(){return this.m_model}}class gt extends p{constructor(t=h,e=null){super(e),this.m_orientation=t,this.m_orientation,this.m_hover=!1,this.m_origMouseGlobalPos=0,this.m_origGlobalPos=0,this.m_move=!1,this.m_min=0,this.m_max=0}mouseDownEvent(t){this.m_move=!0;const e=this.toGlobalPoint(0,0);this.m_orientation==h?(this.m_origMouseGlobalPos=t.globalPos.y,this.m_origGlobalPos=e.y):(this.m_origMouseGlobalPos=t.globalPos.x,this.m_origGlobalPos=e.x),t.accept()}mouseMoveEvent(t){if(this.m_orientation==h?this.m_canvas.style.cursor="s-resize":this.m_canvas.style.cursor="e-resize",this.m_move){const e=this.toGlobalPoint(0,0);if(this.m_orientation==h){const i=this.parent.toLocalPoint(e.x,this.m_origGlobalPos+t.globalPos.y-this.m_origMouseGlobalPos);this.y=l.bound(this.m_min,i.y,this.m_max)}else{const i=this.parent.toLocalPoint(this.m_origGlobalPos+t.globalPos.x-this.m_origMouseGlobalPos,e.y);this.x=l.bound(this.m_min,i.x,this.m_max)}this.invokeEvent("moved")}t.accept()}mouseUpEvent(t){this.m_move=!1}mouseEnterEvent(){this.m_hover=!0}mouseLeaveEvent(){this.m_hover=!1,this.m_canvas.style.cursor="default"}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=.5*p.DEVICE_PIXEL_RATIO,s=10*p.DEVICE_PIXEL_RATIO;let n=this.m_context;n.strokeStyle=this.style.active.text,n.lineWidth=i,n.beginPath(),this.m_orientation==h?(n.moveTo(t/2-s,e/2+i),n.lineTo(t/2+s,e/2+i)):(n.moveTo(t/2+i,e/2-s),n.lineTo(t/2+i,e/2+s)),n.stroke(),n.fill,this.clipEnd()}}class xt extends p{constructor(t=h,e=null){super(e),this.m_orientation=t,this.m_widgets=[],this.m_splitters=[],this.m_updateWidgets=!1,this.m_splitterSize=4}set splitterSize(t){this.m_splitterSize=t,this.m_updateWidgets=!0}get splitterSize(){return this.m_splitterSize}addWidget(t,e=1){if(-1==this.m_widgets.indexOf(t)){if(null!=t.parent&&t.parent.removeChild(t),this.addChild(t),this.m_widgets.length>0){let t=this.createSplitter(this.m_orientation,this);t.addEventListener("moved",this.onSplitterMoved.bind(this)),this.m_splitters.push(t)}t.stretch=Math.max(1,e),this.m_widgets.push(t),this.m_updateWidgets=!0}}onSplitterMoved(t){const e=this.m_splitters.indexOf(t),i=e-1,s=e+1;let n=0,o=0,l=this.m_widgets[e],r=this.m_widgets[e+1];const m=this.m_splitterSize;this.m_orientation==h?(i>=0&&(n=this.m_splitters[i].y+m),o=this.height-m,s<this.m_splitters.length&&(o=this.m_splitters[s].y-m),l.y=Math.trunc(n),l.height=Math.trunc(t.y-n),r.y=Math.trunc(t.y+m),r.height=Math.trunc(o-t.y)):(i>=0&&(n=this.m_splitters[i].x+m),o=this.width-m,s<this.m_splitters.length&&(o=this.m_splitters[s].x-m),l.x=Math.trunc(n),l.width=Math.trunc(t.x-n),r.x=Math.trunc(t.x+m),r.width=Math.trunc(o-t.x)),t.m_min=n,t.m_max=o}update(t){let e=0;for(let t of this.m_widgets)e+=t.stretch;if(this.m_dirty)if(this.m_orientation==h)for(let t=0;t<this.m_widgets.length;++t)this.m_widgets[t].width=this.width,t<this.m_splitters.length&&(this.m_splitters[t].width=this.width);else for(let t=0;t<this.m_widgets.length;++t)this.m_widgets[t].height=this.height,t<this.m_splitters.length&&(this.m_splitters[t].height=this.height);if(this.m_updateWidgets){if(this.m_orientation==h){let t=0;const i=this.height-this.m_splitters.length*this.m_splitterSize;for(let s=0;s<this.m_widgets.length;++s){let h=this.m_widgets[s];if(h.y=t,h.height=i*(h.stretch/e),h.x=0,h.minimumHeight=0,s<this.m_splitters.length){let e=this.m_splitters[s];e.x=0,e.y=h.y+h.height,e.height=this.m_splitterSize,e.m_min=h.y,e.m_max=h.y+h.height,t+=h.height+e.height}}}else{let t=0;const i=this.width-this.m_splitters.length*this.m_splitterSize;for(let s=0;s<this.m_widgets.length;++s){let h=this.m_widgets[s];if(h.x=t,h.width=i*(h.stretch/e),h.y=0,h.minimumWidth=0,s<this.m_splitters.length){let e=this.m_splitters[s];e.y=0,e.x=h.x+h.width,e.width=this.m_splitterSize,e.m_min=h.x,e.m_max=h.x+h.width,t+=h.width+e.width}}}this.m_updateWidgets=!1}super.update(t)}createSplitter(t,e){return new gt(t,e)}}let Et=document.getElementById("xwidget");var pt=new class extends p{constructor(t){super(t),this.m_tabs=[],this.m_buttons=[],this.m_tabAdded=!1,this.m_currentTabIndex=-1,this.m_oldTabIndex=-1,this.m_contentsWidget=new p(this),this.m_contentsWidget.objectName="XTabWidget contentWidget",this.m_tabButtonHeight=30,this.m_tabButtonWidth=110,this.m_startPosX=0,this.m_endPosX=0,this.m_expectedPosX=0,this.m_animationElapsed=0,this.m_drawLine=!0}addTab(t,e){t.m_parent!=this&&null!=t.m_parent&&t.m_parent.removeChild(t),this.m_tabs.push(t);let i=this.createButton(e,this);i.addEventListener("clicked",this.tabClicked.bind(this)),i.addEventListener("moving",this.tabMoving.bind(this)),i.addEventListener("stopped",this.tabStopped.bind(this)),this.m_buttons.push(i),this.m_contentsWidget.addChild(t),this.m_tabAdded=!0,this.currentTabIndex=this.m_tabs.length-1}get tabs(){return this.m_tabs}removeTab(t){if(t>=0&&t<this.m_tabs.length){this.m_contentsWidget.removeChild(this.m_tabs[t]);let e=this.m_tabs[t];return this.m_tabs.splice(t,0),this.m_buttons.splice(t,0),e}return null}moveTabToLeft(t){t>0&&this.swapTab(t,t-1)}moveTabToRight(t){t<this.m_buttons.length-1&&this.swapTab(t,t+1)}swapTab(t,e){this.m_startPosX=this.m_currentTabIndex*this.m_tabButtonWidth;let i=this.m_buttons[t],s=this.m_buttons[e],h=i.m_index;i.m_index=s.m_index,s.m_index=h;let n=this.m_buttons[t];this.m_buttons[t]=this.m_buttons[e],this.m_buttons[e]=n;let o=this.m_tabs[t];this.m_tabs[t]=this.m_tabs[e],this.m_tabs[e]=o,this.currentTabIndex=e,this.m_endPosX=this.m_currentTabIndex*this.m_tabButtonWidth}createButton(t,e){return new T(t,e)}tabClicked(t,e){this.m_startPosX=this.m_currentTabIndex*this.m_tabButtonWidth,this.currentTabIndex=t.m_index,this.m_endPosX=this.m_currentTabIndex*this.m_tabButtonWidth}tabMoving(t,e){this.m_drawLine=!1}tabStopped(t,e){this.m_drawLine=!0}set currentTabIndex(t){t>=0&&t<this.m_tabs.length&&t!=this.m_currentTabIndex&&(this.m_oldTabIndex=this.m_currentTabIndex,this.m_currentTabIndex=t,-1!=this.m_oldTabIndex&&(this.m_tabs[this.m_oldTabIndex].visible=!1,this.m_buttons[this.m_oldTabIndex].foregroundColor=this.style.active.text,this.m_buttons[this.m_oldTabIndex].backgroundColor=this.style.active.button),-1!=this.m_currentTabIndex&&(this.m_tabs[this.m_currentTabIndex].visible=!0,this.m_buttons[this.m_currentTabIndex].foregroundColor=this.style.active.highlightedText,this.m_buttons[this.m_currentTabIndex].backgroundColor=this.style.active.highlighted))}get currentTabIndex(){return this.m_currentTabIndex}update(t){const e=this.m_dirty;if(e){const t=5;this.m_contentsWidget.x=0,this.m_contentsWidget.y=this.m_tabButtonHeight+t,this.m_contentsWidget.width=this.width,this.m_contentsWidget.height=this.height-this.m_tabButtonHeight-t-1}if(this.m_tabAdded||e){let t=0,e=0;for(let i of this.m_buttons)i.m_index=e,i.width=this.m_tabButtonWidth,i.height=this.m_tabButtonHeight,i.x=t,e++,t+=i.width;this.m_tabAdded=!1}this.m_expectedPosX!=this.m_endPosX?(this.m_animationElapsed+=t,this.m_expectedPosX=l.lerp(this.m_startPosX,this.m_endPosX,this.m_animationElapsed/200,l.inOutQuad),this.m_animationElapsed>=200&&(this.m_expectedPosX=this.m_endPosX,this.m_animationElapsed=0)):(this.m_expectedPosX=this.m_currentTabIndex*this.m_tabButtonWidth,this.m_endPosX=this.m_expectedPosX),super.update(t)}draw(){this.applyTransformToContext(),this.clipStart();const t=this.m_width*p.DEVICE_PIXEL_RATIO,e=this.m_height*p.DEVICE_PIXEL_RATIO,i=this.m_tabButtonHeight*p.DEVICE_PIXEL_RATIO,s=this.m_tabButtonWidth*p.DEVICE_PIXEL_RATIO;this.m_context.fillStyle=this.style.active.widget,this.m_context.fillRect(0,0,t,e),this.m_context.clearRect(0,0,t,i);const h=2*p.DEVICE_PIXEL_RATIO;this.m_drawLine&&(this.m_context.fillStyle=this.style.active.highlighted,this.m_context.fillRect(this.m_expectedPosX*p.DEVICE_PIXEL_RATIO,i,s,h)),this.drawChildren(),this.clipEnd()}}(Et);pt.addTab(function(){let t=new p;t.height=1e4,t.width=1e4,t.rotation=0,t.objectName="scrollWidget";let e=new D;e.height=400,e.width=200,e.y=100,e.x=500,e.scrollWidget=t,e.rotation=0,e.objectName="scrollArea";for(let e=0;e<100;e++)for(let i=0;i<100;i++){let s=new v("test",t);s.text=e+" "+i,s.width=50,s.objectName="scrollareabutton",s.height=50,s.foregroundColor="black",s.x=60*e,s.y=60*i,s.addEventListener("clicked",(function(t){console.log(t.text)}))}let i=new p;i.width=700,i.height=500,i.objectName="page1";let s=new A(h,i);return s.addWidget(e),s.margins=0,i}(),"Scroll Area"),pt.addTab(function(){let t=new p;t.width=700,t.height=500,t.objectName="page2";let e=new A(h,t);return e.addWidget(new U),e.margins=0,t}(),"Text Edit"),pt.addTab(function(){let t=new F(10);for(let e=0;e<1e3;++e){let i=[];for(let t=0;t<10;++t){const s="r:"+e+"  c:"+t+"  i:"+(10*e+t);i.push(s)}t.addRow(i)}for(let e=0;e<10;++e)t.setColumnHeaderText(e,"HAHAHA "+e);var e=new Z;e.model=t;let i=new p;i.width=700,i.height=500,i.objectName="page3";let s=new A(h,i);return s.addWidget(e),s.margins=0,i}(),"Table View"),pt.addTab(function(){let t=new p;t.width=780,t.height=540,t.x=0,t.y=0,t.objectName="page4";let e=new A(n,t);e.margins=0,e.spacing=4;var i=new $,s=new it;s.model=i,e.addWidget(s);let o=new p,l=new A(h,o),r=new Y,m=new st,a=new w;a.text="Add item",a.addEventListener("clicked",(function(t){let e=r.text;0==e.length&&(e="---"),i.add(e),m.addItem(e)}));let _=new w;_.text="Remove item",_.addEventListener("clicked",(function(t){i.remove(0),m.removeItem(0)}));let d=new w;d.text="Show dialog",d.addEventListener("clicked",(function(t){Pt.visible=!0}));let c=new I;c.text="hello";let u=new C;u.text="radio1";let g=new C;g.text="radio2";let x=new ht;x.minValue=-100,x.maxValue=100,x.value=0;let E=new nt(null,!1);return E.minValue=-100,E.maxValue=100,E.value=0,E.addEventListener("valueChanged",(function(t){x.value=t.value})),l.margins=0,l.addWidget(r),l.addWidget(a),l.addWidget(_),l.addWidget(m),l.addWidget(c),l.addWidget(u),l.addWidget(g),l.addWidget(x),l.addWidget(E),l.addWidget(d),l.addStretch(),e.addWidget(o),t}(),"List View"),pt.addTab(function(){let t=new at,e=new mt("root");e.expanded=!0,t.addRootItem(e),t.addItem(new mt("c1"),0),t.addItem(new mt("c2"),0),t.addItem(new mt("c3"),0),t.addItem(new mt("c4"),0),t.addItem(new mt("c5"),0);let i=t.findItem(2);i.addChild(new mt("d1")),i.addChild(new mt("d2")),i.addChild(new mt("d3")),i.addChild(new mt("d4")),i.addChild(new mt("d5"));let s=new mt("root2");t.addRootItem(s),s.addChild(new mt("f1")),s.addChild(new mt("f2")),s.addChild(new mt("f3")),s.addChild(new mt("f4"));let n=new mt("root3");t.addRootItem(n),n.addChild(new mt("g1")),n.addChild(new mt("g2")),n.addChild(new mt("g3")),n.addChild(new mt("g4")),n.addChild(new mt("g5"));let o=n.findItem(1);o.addChild(new mt("h1")),o.addChild(new mt("h2")),o.addChild(new mt("h3"));let l=new ut;l.model=t;let r=new p;r.width=700,r.height=500;let m=new A(h,r);return m.addWidget(l),m.margins=0,r}(),"Tree View"),pt.addTab(function(){let t=new xt(n);t.addWidget(new U),t.addWidget(new U);let e=new xt(h);e.width=780,e.height=500,e.addWidget(t,5),e.addWidget(new w("test"),2.5),e.addWidget(new w("test"),2.5);let i=new p;i.width=700,i.height=500;let s=new A(h,i);return s.addWidget(e),s.margins=0,i}(),"Splitter"),pt.x=0,pt.y=0,pt.width=800,pt.height=600,pt.objectName="RootTabWidget",pt.contentsMargins.left=0;for(let t of pt.tabs)t.width=798,t.height=560;let Pt=new rt(pt);Pt.objectName="dialog",Pt.y=50,Pt.x=50,Pt.title="Title",Pt.resizable=!0,Pt.raise();let bt=new class extends W{constructor(t=null){super(t),this.m_labelMap=new Map,this.m_items=[],this.m_labelsAlignment=34,this.m_labelsHoriStretch=1,this.m_widgetsHoriStretch=1,this.m_fillers=[],this.m_usedHeight=0}set labelsHorizontalStretch(t){this.m_labelsHoriStretch=Math.max(1,t),this.m_dirty=!0}set widgetsHorizontalStretch(t){this.m_widgetsHoriStretch=Math.max(1,t),this.m_dirty=!0}set labelsAlignment(t){this.m_labelsAlignment=t,this.m_dirty=!0}get recommendedWidth(){this.m_dirty&&this.update();let t=0;for(let e of this.m_items){let i=this.m_labelMap.get(e);null!=i&&i.recommendedWidth>t&&(t=i.recommendedWidth)}let e=0;return this.m_parent instanceof p?e=this.m_parent.contentsMargins.left+this.m_parent.contentsMargins.right:this.m_parent instanceof W&&(e=this.m_parent.margins.left+this.m_parent.margins.right),t*this.m_labelsHoriStretch+t*this.m_widgetsHoriStretch+this.m_margins.left+this.m_margins.right+this.m_spacing+e}get recommendedHeight(){this.m_dirty&&this.update();let t=0;this.m_parent instanceof p?t=this.m_parent.contentsMargins.top+this.m_parent.contentsMargins.bottom:this.m_parent instanceof W&&(t=this.m_parent.margins.top+this.m_parent.margins.bottom);const e=this.m_items.length-this.m_fillers.length;return this.m_usedHeight+this.m_margins.top+this.m_margins.bottom+(e-1)*this.m_spacing+t}update(t){if(null!=this.m_parent){if(this.m_dirty){let t=0,e=0;for(let i of this.m_items)i.visible&&(e++,t+=i.stretch);let i=0;for(let t of this.m_fillers)t.visible&&i++;const s=e-i;console.log("count "+s);let h=this.parentWidget(this),n=0,o=0;this.m_parent instanceof p&&(n=this.m_parent.contentsMargins.left+this.m_parent.contentsMargins.right,o=this.m_parent.contentsMargins.top+this.m_parent.contentsMargins.bottom);const l=this.width-this.m_spacing-(this.m_margins.left+this.m_margins.right)-n,r=this.height-(s-1)*this.m_spacing-(this.m_margins.top+this.m_margins.bottom)-o,m=this.m_labelsHoriStretch+this.m_widgetsHoriStretch,a=l*(this.m_labelsHoriStretch/m),_=l*(this.m_widgetsHoriStretch/m);let d=this.m_margins.left;this.m_parent instanceof p&&(d+=this.m_parent.contentsMargins.left),this.m_parent instanceof W&&(d+=this.x),this.m_usedHeight=0;const c=i>0;for(let e=0;e<this.m_items.length;++e){let i=this.m_items[e],s=null;if(i instanceof p&&(s=this.m_labelMap.get(i),s.parent!=h&&h instanceof p&&h.addChild(s),i.parent!=h&&h instanceof p&&h.addChild(i)),i.width=Math.trunc(_),i.x=Math.trunc(d+a+this.m_spacing),null!=s&&(s.x=Math.trunc(d),s.width=Math.trunc(a),s.alignment=this.m_labelsAlignment,s.enabled=i.enabled),i.stretch>0){let e=r*(i.stretch/t);c&&(e=i.recommendedHeight),i.height=e,e=i.height,null!=s&&(s.height=Math.trunc(e)),this.m_usedHeight+=e}}const u=Math.trunc(r-this.m_usedHeight);for(let t of this.m_fillers){t.height=u/i-this.m_spacing;let e=this.m_labelMap.get(t);null!=e&&(e.height=t.height)}let g=this.m_margins.top;this.m_parent instanceof p&&(g+=this.m_parent.contentsMargins.top),this.m_parent instanceof W&&(g+=this.y);for(let t of this.m_items)if(t.height>0&&t.visible){let e=this.m_labelMap.get(t);null!=e&&(e.y=Math.trunc(g)),t.y=Math.trunc(g),g+=t.height+this.m_spacing}this.m_dirty=!1}for(let e of this.m_items)e instanceof W&&e.update(t)}else console.log("layout has no parent")}removeWidget(t){let e=this.m_items.indexOf(t);if(-1!=e){t.removeEventListener("hidden",this.onWidgetHidden.bind(this)),t.removeEventListener("shown",this.onWidgetShown.bind(this)),t.removeEventListener("enabled",this.onWidgetEnabled.bind(this)),t.removeEventListener("disabled",this.onWidgetDisabled.bind(this));let i=this.m_fillers.indexOf(t);-1!=i&&this.m_fillers.splice(i,1);let s=m_labelMap.get(t);this.m_parent==s.parent&&this.m_parent instanceof p&&this.m_parent.removeChild(s),this.m_labelMap.remove(t),this.m_items.splice(e,1),this.m_dirty=!0}}onWidgetShown(t){let e=this.m_labelMap.get(t);null!=e&&(e.visible=!0)}onWidgetHidden(t){let e=this.m_labelMap.get(t);null!=e&&(e.visible=!1)}onWidgetEnabled(t){let e=this.m_labelMap.get(t);null!=e&&(e.enabled=!0)}onWidgetDisabled(t){let e=this.m_labelMap.get(t);null!=e&&(e.enabled=!1)}addWidget(t,e,i=1){if(e instanceof p){this.removeWidget(e),e.addEventListener("hidden",this.onWidgetHidden.bind(this)),e.addEventListener("shown",this.onWidgetShown.bind(this)),e.addEventListener("enabled",this.onWidgetEnabled.bind(this)),e.addEventListener("disabled",this.onWidgetDisabled.bind(this));var s=new S(t);s.alignment=34,this.m_labelMap.set(e,s),this.m_items.push(e),this.m_dirty=!0,e.stretch=i,s.stretch=i,i<=0&&this.m_fillers.push(e)}}addSpacer(t){let e=new R;e.stretch=t,this.m_items.push(e),this.m_dirty=!0,t<=0&&this.m_fillers.push(e)}addStretch(){this.addSpacer(0)}};bt.addWidget("Label 1",new Y),bt.addWidget("Label 2",new Y),bt.addStretch(),bt.margins=0;let yt=new A(h);yt.addStretch(),yt.addWidget(new w("bbbb")),yt.addWidget(new w("bbbb")),yt.margins=0;let ft=new A(n,Pt);ft.addWidget(new w("gggg")),ft.addWidget(new w("gggg")),ft.addLayout(bt,5),ft.addLayout(yt),Pt.minimumWidth=450,Pt.minimumHeight=ft.recommendedHeight;let wt=new class{constructor(){this.m_lastTimestamp=0,this.m_fps=0,this.m_fpsTimer=0,this.m_lastFps=0,this.m_showFps=!1,this.m_showDebugMessage=!1}set showFps(t){this.m_showFps=t}set showDebugMessage(t){this.m_showDebugMessage=t}loop(t){const e=t-this.m_lastTimestamp;this.m_lastTimestamp=t,this.m_showFps&&(this.m_fpsTimer+=e,++this.m_fps,this.m_fpsTimer>=1e3&&(this.m_fpsTimer=0,this.m_lastFps=this.m_fps,this.m_fps=0));for(let t of p.CANVAS_LIST){let i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);let s=p.ROOT_WIDGET_MAP.get(t);for(let t=0;t<s.length;++t){let i=s[t];i.requestUpdate(e),i.draw()}if(this.m_showFps||this.m_showDebugMessage){i.textAlign="left",i.textBaseline="top",i.fillStyle="red",i.resetTransform();const t=12*p.DEVICE_PIXEL_RATIO,e="Arial";i.font=t+"px "+e;let s=2;this.m_showFps&&(i.fillText("fps:"+this.m_lastFps,2,s),s+=t+2*p.DEVICE_PIXEL_RATIO),this.m_showDebugMessage&&i.fillText(p.DEBUG_MESSAGE,2,s)}}requestAnimationFrame(this.loop.bind(this))}exec(){requestAnimationFrame(this.loop.bind(this))}};wt.exec()})();